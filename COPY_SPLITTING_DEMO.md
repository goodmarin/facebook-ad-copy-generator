# 📝 文案切割功能演示

## 🎯 功能概述

文案切割功能负责将AI生成的响应文本分割成独立的广告文案。这个功能支持多种格式，确保无论AI返回什么格式，都能正确提取文案。

## 🔧 工作原理

### 第一轮：Copy X: 格式检测（最优先）

```typescript
// 检测标准格式：Copy 1:, Copy 2:, Copy 3:
if (aiResponse.includes('Copy 1:') || aiResponse.includes('Copy 2:') || aiResponse.includes('Copy 3:')) {
  const copyRegex = /Copy \d+[：:]\s*([^\n]+)/g;
  const matches = [...aiResponse.matchAll(copyRegex)];
  
  for (const match of matches) {
    let copyText = match[1]?.trim();
    if (copyText && copyText.length > 15) {
      copies.push(copyText);
    }
  }
}
```

**支持的格式示例：**
```
Copy 1: 🚀 改变你的生活方式！我们的产品专为年轻人设计
Copy 2: 💎 发现产品的独特魅力！让您在人群中脱颖而出
Copy 3: 🔥 热销爆款！成为用户的首选，现在购买享受专属优惠
```

### 第二轮：分隔符分割

如果Copy X:格式失败，尝试使用分隔符：

```typescript
// 使用 | 分割
if (aiResponse.includes('|')) {
  const pipeSplit = aiResponse.split('|')
    .map((copy) => copy.trim())
    .filter((copy) => copy.length > 20 && copy.length < 300)
    .slice(0, 3);
  copies = pipeSplit;
}

// 使用换行符分割
else if (aiResponse.includes('\n')) {
  const lineSplit = aiResponse.split('\n')
    .map((line) => line.trim())
    .filter((line) => 
      line.length > 20 && 
      line.length < 300 && 
      !line.includes('Copy') && 
      !line.includes('文案') &&
      !line.includes('广告')
    )
    .slice(0, 3);
  copies = lineSplit;
}
```

**支持的格式示例：**
```
🚀 改变你的生活方式！我们的产品专为年轻人设计
💎 发现产品的独特魅力！让您在人群中脱颖而出
🔥 热销爆款！成为用户的首选，现在购买享受专属优惠
```

### 第三轮：智能分割

如果前两轮都失败，使用标点符号分割：

```typescript
const sentences = aiResponse.split(/[.!?。！？]/)
  .map((s) => s.trim())
  .filter((s) => 
    s.length > 20 && 
    s.length < 300 && 
    !s.includes('Copy') && 
    !s.includes('文案') &&
    !s.includes('广告')
  )
  .slice(0, 3);
```

**支持的格式示例：**
```
🚀 改变你的生活方式！我们的产品专为年轻人设计。💎 发现产品的独特魅力！让您在人群中脱颖而出。🔥 热销爆款！成为用户的首选，现在购买享受专属优惠。
```

## 📊 测试结果

### 测试1：标准Copy X:格式 ✅
```
输入：Copy 1: [文案1] Copy 2: [文案2] Copy 3: [文案3]
输出：3条独立文案
```

### 测试2：|分隔符格式 ✅
```
输入：文案1|文案2|文案3
输出：3条独立文案
```

### 测试3：换行符格式 ✅
```
输入：文案1\n文案2\n文案3
输出：3条独立文案
```

### 测试4：句号分割格式 ✅
```
输入：文案1。文案2。文案3。
输出：3条独立文案
```

### 测试5：错误响应 ✅
```
输入：抱歉，我无法生成广告文案
输出：0条文案，将使用备用模板
```

## 🎨 文案清理

提取文案后，会进行以下清理：

1. **移除多余标点**：`^[|:：\s]+` 和 `[|:：\s]+$`
2. **长度限制**：超过300字符时截断并添加`...`
3. **emoji清理**：移除可能导致乱码的字符
4. **质量过滤**：只保留15-500字符的文案

## 🔍 调试信息

系统会输出详细的调试信息：

```
🔍 检测到Copy X:格式，使用精确分割
📝 找到 3 个Copy X:匹配项
✅ 添加文案: 🚀 改变你的生活方式！我们的产品专为年轻人设计...
🎯 Copy X:格式成功提取 3 条文案，跳过其他分割方式
```

## ⚠️ 常见问题

### 问题1：AI没有返回Copy X:格式
**解决方案**：系统会自动尝试其他分割方式，确保能提取文案

### 问题2：文案被合并
**解决方案**：Copy X:格式检测会优先执行，避免二次分割

### 问题3：提取的文案质量差
**解决方案**：多重过滤确保文案长度和内容质量

## 🚀 性能优化

1. **优先级排序**：Copy X:格式优先，避免不必要的处理
2. **早期返回**：成功提取后立即返回，跳过后续处理
3. **数量限制**：最多提取3条文案，避免过多处理
4. **缓存机制**：相同参数直接返回缓存结果

## 📱 用户体验

- **无缝处理**：用户无需关心AI返回的格式
- **智能适应**：自动识别并处理各种格式
- **质量保证**：确保提取的文案符合要求
- **错误处理**：失败时自动使用备用模板

## 🎯 总结

文案切割功能是一个智能的、多层次的文本处理系统：

1. **三层检测**：Copy X: → 分隔符 → 智能分割
2. **智能过滤**：长度、内容、格式多重验证
3. **质量保证**：清理、验证、优化
4. **用户友好**：完全自动化，无需手动干预

这个功能确保了无论AI返回什么格式，用户都能获得高质量的、独立的广告文案。
