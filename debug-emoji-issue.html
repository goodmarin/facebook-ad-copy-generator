<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Emojié—®é¢˜è°ƒè¯•</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .debug-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .debug-result {
            background: #f0f8ff;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            border-left: 4px solid #007acc;
            font-family: monospace;
            white-space: pre-wrap;
        }
        .error {
            background: #fff0f0;
            border-left-color: #ff4444;
        }
        .success {
            background: #f0fff0;
            border-left-color: #44ff44;
        }
        button {
            background: #007acc;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #005a9e;
        }
        .emoji-display {
            font-size: 24px;
            margin: 10px 0;
            padding: 10px;
            background: #f8f8f8;
            border-radius: 5px;
        }
        .char-analysis {
            font-family: monospace;
            font-size: 12px;
            background: #f0f0f0;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>ğŸ” Emojié—®é¢˜è°ƒè¯•å·¥å…·</h1>
    
    <div class="debug-section">
        <h2>æµ‹è¯•1: å­—ç¬¦ç¼–ç åˆ†æ</h2>
        <p>åˆ†ææ–‡æ¡ˆä¸­æ¯ä¸ªå­—ç¬¦çš„Unicodeç¼–ç ï¼š</p>
        <button onclick="analyzeCharacters()">åˆ†æå­—ç¬¦ç¼–ç </button>
        <div id="char-analysis-result"></div>
    </div>

    <div class="debug-section">
        <h2>æµ‹è¯•2: æ–‡æ¡ˆæ¨¡æ¿æµ‹è¯•</h2>
        <p>æµ‹è¯•æ—¥æœ¬æ–‡æ¡ˆæ¨¡æ¿çš„æ˜¾ç¤ºï¼š</p>
        <button onclick="testJapaneseTemplates()">æµ‹è¯•æ—¥æœ¬æ¨¡æ¿</button>
        <div id="template-test-result"></div>
    </div>

    <div class="debug-section">
        <h2>æµ‹è¯•3: ç¬¦å·æ˜¾ç¤ºæµ‹è¯•</h2>
        <p>æµ‹è¯•å„ç§ç¬¦å·çš„æ˜¾ç¤ºæ•ˆæœï¼š</p>
        <div class="emoji-display">
            <div>æ ‡å‡†emoji: âœ¨ â­ ğŸ’ª ğŸš€ ğŸ’ ğŸ”¥</div>
            <div>å‡ ä½•ç¬¦å·: â—† â—‡ â–  â–¡ â–² â–³ â–¶ â–· â— â—‹ â˜… â˜†</div>
            <div>å…¶ä»–ç¬¦å·: âš¡ âšª âš« ğŸŒŸ ğŸ’« ğŸ¯ ğŸ‰</div>
        </div>
        <div id="symbol-test-result"></div>
    </div>

    <div class="debug-section">
        <h2>æµ‹è¯•4: æ–‡æ¡ˆç”Ÿæˆæ¨¡æ‹Ÿ</h2>
        <p>æ¨¡æ‹Ÿå¿«é€Ÿæ¨¡å¼çš„æ–‡æ¡ˆç”Ÿæˆè¿‡ç¨‹ï¼š</p>
        <button onclick="simulateCopyGeneration()">æ¨¡æ‹Ÿæ–‡æ¡ˆç”Ÿæˆ</button>
        <div id="simulation-result"></div>
    </div>

    <script>
        // æ¨¡æ‹ŸcleanEmojiså‡½æ•°
        function cleanEmojis(text) {
            if (!text) return '';
            
            let cleanedText = text;
            
            // ç¬¬ä¸€è½®ï¼šç§»é™¤æ›¿æ¢å­—ç¬¦ï¼ˆçœŸæ­£çš„ä¹±ç ï¼‰
            cleanedText = cleanedText.replace(/[\uFFFD\uFFFE\uFFFF]/g, '');
            
            // ç¬¬äºŒè½®ï¼šç§»é™¤å­¤ç«‹çš„Unicodeä»£ç†å¯¹
            cleanedText = cleanedText.replace(/[\uD800-\uDFFF](?![\uDC00-\uDFFF])/g, '');
            cleanedText = cleanedText.replace(/(?<![\uD800-\uDBFF])[\uDC00-\uDFFF]/g, '');
            
            // ç¬¬ä¸‰è½®ï¼šç§»é™¤æ§åˆ¶å­—ç¬¦ï¼ˆé™¤äº†æ¢è¡Œç¬¦å’Œåˆ¶è¡¨ç¬¦ï¼‰
            cleanedText = cleanedText.replace(/[\u0000-\u0008\u000B\u000C\u000E-\u001F\u007F-\u009F]/g, '');
            
            // ç¬¬å››è½®ï¼šç§»é™¤é›¶å®½å­—ç¬¦
            cleanedText = cleanedText.replace(/[\u200B-\u200D\uFEFF]/g, '');
            
            // ç¬¬äº”è½®ï¼šç§»é™¤å¯èƒ½æœ‰é—®é¢˜çš„å‡ ä½•å›¾å½¢ç¬¦å·ï¼Œä½†ä¿ç•™å®‰å…¨çš„ç¬¦å·
            cleanedText = cleanedText.replace(/[\u25A0-\u25FF]/g, char => {
                const safeGeometricSymbols = ['â—†', 'â—‡', 'â– ', 'â–¡', 'â–²', 'â–³', 'â–¶', 'â–·', 'â—', 'â—‹', 'â˜…', 'â˜†'];
                return safeGeometricSymbols.includes(char) ? char : '';
            });
            
            // ç¬¬å…­è½®ï¼šç§»é™¤å¯èƒ½æœ‰é—®é¢˜çš„ç¬¦å·ï¼Œä½†ä¿ç•™å®‰å…¨çš„ç¬¦å·
            cleanedText = cleanedText.replace(/[\u2600-\u26FF]/g, char => {
                const safeSymbols = ['â­', 'ğŸŒŸ', 'ğŸ’«', 'âš¡', 'âšª', 'âš«'];
                return safeSymbols.includes(char) ? char : '';
            });
            
            // ç¬¬ä¸ƒè½®ï¼šæ™ºèƒ½emojiæ¸…ç† - åªä¿ç•™å®‰å…¨çš„emoji
            cleanedText = cleanedText.replace(/[\u{1F000}-\u{1FFFF}]/gu, char => {
                return isSafeEmoji(char) ? char : '';
            });
            
            // ç¬¬å…«è½®ï¼šæ¸…ç†å¤šä½™çš„ç©ºæ ¼ï¼ˆä¿ç•™æ¢è¡Œç¬¦ä»¥ç»´æŒæ–‡æ¡ˆç»“æ„ï¼‰
            cleanedText = cleanedText.replace(/[ \t]+/g, ' ').trim();
            
            return cleanedText;
        }

        // éªŒè¯emojiæ˜¯å¦å®‰å…¨çš„å‡½æ•°
        function isSafeEmoji(char) {
            const safeEmojiRanges = [
                [0x1F600, 0x1F64F], // è¡¨æƒ…ç¬¦å·
                [0x1F300, 0x1F5FF], // æ‚é¡¹ç¬¦å·å’Œè±¡å½¢æ–‡å­—
                [0x1F680, 0x1F6FF], // äº¤é€šå’Œåœ°å›¾ç¬¦å·
                [0x1F1E0, 0x1F1FF], // åŒºåŸŸæŒ‡ç¤ºç¬¦å·
                [0x2600, 0x26FF],   // æ‚é¡¹ç¬¦å·
                [0x2700, 0x27BF],   // è£…é¥°ç¬¦å·
                [0xFE00, 0xFE0F],   // å˜ä½“é€‰æ‹©å™¨
                [0x1F900, 0x1F9FF], // è¡¥å……ç¬¦å·å’Œè±¡å½¢æ–‡å­—
                [0x1F018, 0x1F270], // å°é—­å­—æ¯æ•°å­—è¡¥å……
                [0x2B00, 0x2BFF],   // æ‚é¡¹ç¬¦å·å’Œç®­å¤´ (åŒ…å«â­ U+2B50)
                [0x2300, 0x23FF],   // æŠ€æœ¯ç¬¦å·
                [0x2000, 0x206F],   // é€šç”¨æ ‡ç‚¹
                [0x2100, 0x214F],   // å­—æ¯ç±»ç¬¦å·
                [0x2190, 0x21FF],   // ç®­å¤´
                [0x2200, 0x22FF],   // æ•°å­¦è¿ç®—ç¬¦
                [0x25A0, 0x25FF],   // å‡ ä½•å›¾å½¢
            ];
            
            const codePoint = char.codePointAt(0);
            if (!codePoint) return false;
            
            return safeEmojiRanges.some(([start, end]) => codePoint >= start && codePoint <= end);
        }

        // åˆ†æå­—ç¬¦ç¼–ç 
        function analyzeCharacters() {
            const testText = 'â—†äººæ°—å•†å“! ã‚¹ãƒãƒ¼ãƒˆãƒ¯ã‚¤ãƒ¤ãƒ¬ã‚¹ãƒ˜ãƒƒãƒ‰ãƒ•ã‚©ãƒ³ã¯ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒã‚¤ã‚ºã‚­ãƒ£ãƒ³ã‚»ãƒªãƒ³ã‚° é•·æ™‚é–“ãƒãƒƒãƒ†ãƒªãƒ¼ æ€¥é€Ÿå……é›» å¿«é©ãªè£…ç€æ„Ÿã§è‹¥ã„ä¼šç¤¾å“¡ éŸ³æ¥½æ„›å¥½å®¶ã®ç¬¬ä¸€é¸æŠè‚¢ã«ã€‚ä»Šã™ãç‰¹åˆ¥å‰²å¼•ã‚’ã‚²ãƒƒãƒˆ!';
            
            const resultDiv = document.getElementById('char-analysis-result');
            let html = '<h3>å­—ç¬¦ç¼–ç åˆ†æç»“æœï¼š</h3>';
            
            html += '<div class="char-analysis">';
            html += 'åŸå§‹æ–‡æ¡ˆ: ' + testText + '\n\n';
            
            for (let i = 0; i < testText.length; i++) {
                const char = testText[i];
                const codePoint = char.codePointAt(0);
                const hexCode = codePoint ? 'U+' + codePoint.toString(16).toUpperCase().padStart(4, '0') : 'N/A';
                const isReplacement = char === '';
                
                html += `ä½ç½®${i}: "${char}" - ${hexCode} - æ›¿æ¢å­—ç¬¦: ${isReplacement}\n`;
            }
            html += '</div>';
            
            // æ£€æŸ¥æ˜¯å¦æœ‰æ›¿æ¢å­—ç¬¦
            const hasReplacement = testText.includes('');
            const status = hasReplacement ? 'âŒ å‘ç°æ›¿æ¢å­—ç¬¦' : 'âœ… æ— æ›¿æ¢å­—ç¬¦';
            const statusClass = hasReplacement ? 'error' : 'success';
            
            html += `<div class="debug-result ${statusClass}">
                <strong>æ£€æµ‹ç»“æœ:</strong> ${status}<br>
                <strong>æ–‡æ¡ˆé•¿åº¦:</strong> ${testText.length} å­—ç¬¦<br>
                <strong>åŒ…å«æ›¿æ¢å­—ç¬¦:</strong> ${hasReplacement ? 'æ˜¯' : 'å¦'}
            </div>`;
            
            resultDiv.innerHTML = html;
        }

        // æµ‹è¯•æ—¥æœ¬æ–‡æ¡ˆæ¨¡æ¿
        function testJapaneseTemplates() {
            const templates = [
                'âœ¨ {product}ã§äººç”Ÿã‚’å¤‰ãˆã‚ˆã†ï¼{features}ã€{audience}ã®ãŸã‚ã«è¨­è¨ˆã•ã‚Œã¾ã—ãŸã€‚ãƒ†ã‚¯ãƒãƒ­ã‚¸ãƒ¼ã¨ãƒ©ã‚¤ãƒ•ã‚¹ã‚¿ã‚¤ãƒ«ã®å®Œç’§ãªèåˆã‚’ä½“é¨“ã—ã‚ˆã†ï¼',
                'â­ {product}ã®ç‹¬ç‰¹ãªé­…åŠ›ã‚’ç™ºè¦‹ï¼{features}ã§{audience}ã®ä¸­ã§éš›ç«‹ã¨ã†ã€‚æœŸé–“é™å®šã‚ªãƒ•ã‚¡ãƒ¼ã€ãŠè¦‹é€ƒã—ãªãï¼',
                'ğŸ’ª äººæ°—å•†å“ï¼{product}ã¯{features}ã§{audience}ã®ç¬¬ä¸€é¸æŠè‚¢ã«ã€‚ä»Šã™ãç‰¹åˆ¥å‰²å¼•ã‚’ã‚²ãƒƒãƒˆï¼'
            ];

            const resultDiv = document.getElementById('template-test-result');
            let html = '<h3>æ—¥æœ¬æ–‡æ¡ˆæ¨¡æ¿æµ‹è¯•ç»“æœï¼š</h3>';

            templates.forEach((template, index) => {
                // æ¨¡æ‹Ÿæ›¿æ¢å˜é‡
                let processedTemplate = template
                    .replace('{product}', 'ã‚¹ãƒãƒ¼ãƒˆãƒ¯ã‚¤ãƒ¤ãƒ¬ã‚¹ãƒ˜ãƒƒãƒ‰ãƒ•ã‚©ãƒ³')
                    .replace('{features}', 'ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒã‚¤ã‚ºã‚­ãƒ£ãƒ³ã‚»ãƒªãƒ³ã‚° é•·æ™‚é–“ãƒãƒƒãƒ†ãƒªãƒ¼ æ€¥é€Ÿå……é›» å¿«é©ãªè£…ç€æ„Ÿ')
                    .replace('{audience}', 'è‹¥ã„ä¼šç¤¾å“¡ éŸ³æ¥½æ„›å¥½å®¶');

                const cleaned = cleanEmojis(processedTemplate);
                const hasReplacementChar = cleaned.includes('');
                const status = hasReplacementChar ? 'âŒ å¤±è´¥' : 'âœ… æˆåŠŸ';
                const statusClass = hasReplacementChar ? 'error' : 'success';

                html += `
                    <div class="debug-result ${statusClass}">
                        <strong>æ¨¡æ¿ ${index + 1}:</strong> ${status}<br>
                        <strong>åŸå§‹æ¨¡æ¿:</strong> ${template}<br>
                        <strong>å¤„ç†åæ–‡æ¡ˆ:</strong> ${processedTemplate}<br>
                        <strong>æ¸…ç†åæ–‡æ¡ˆ:</strong> ${cleaned}<br>
                        <strong>åŒ…å«æ›¿æ¢å­—ç¬¦:</strong> ${hasReplacementChar ? 'æ˜¯' : 'å¦'}
                    </div>
                `;
            });

            resultDiv.innerHTML = html;
        }

        // æ¨¡æ‹Ÿæ–‡æ¡ˆç”Ÿæˆè¿‡ç¨‹
        function simulateCopyGeneration() {
            const resultDiv = document.getElementById('simulation-result');
            let html = '<h3>æ–‡æ¡ˆç”Ÿæˆæ¨¡æ‹Ÿç»“æœï¼š</h3>';

            // æ¨¡æ‹Ÿäº§å“ä¿¡æ¯
            const productInfo = {
                name: 'ã‚¹ãƒãƒ¼ãƒˆãƒ¯ã‚¤ãƒ¤ãƒ¬ã‚¹ãƒ˜ãƒƒãƒ‰ãƒ•ã‚©ãƒ³',
                features: 'ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒã‚¤ã‚ºã‚­ãƒ£ãƒ³ã‚»ãƒªãƒ³ã‚° é•·æ™‚é–“ãƒãƒƒãƒ†ãƒªãƒ¼ æ€¥é€Ÿå……é›» å¿«é©ãªè£…ç€æ„Ÿ',
                targetAudience: 'è‹¥ã„ä¼šç¤¾å“¡ éŸ³æ¥½æ„›å¥½å®¶'
            };

            // æ¨¡æ‹Ÿæ—¥æœ¬æ–‡æ¡ˆæ¨¡æ¿
            const templates = [
                'âœ¨ {product}ã§äººç”Ÿã‚’å¤‰ãˆã‚ˆã†ï¼{features}ã€{audience}ã®ãŸã‚ã«è¨­è¨ˆã•ã‚Œã¾ã—ãŸã€‚ãƒ†ã‚¯ãƒãƒ­ã‚¸ãƒ¼ã¨ãƒ©ã‚¤ãƒ•ã‚¹ã‚¿ã‚¤ãƒ«ã®å®Œç’§ãªèåˆã‚’ä½“é¨“ã—ã‚ˆã†ï¼',
                'â­ {product}ã®ç‹¬ç‰¹ãªé­…åŠ›ã‚’ç™ºè¦‹ï¼{features}ã§{audience}ã®ä¸­ã§éš›ç«‹ã¨ã†ã€‚æœŸé–“é™å®šã‚ªãƒ•ã‚¡ãƒ¼ã€ãŠè¦‹é€ƒã—ãªãï¼',
                'ğŸ’ª äººæ°—å•†å“ï¼{product}ã¯{features}ã§{audience}ã®ç¬¬ä¸€é¸æŠè‚¢ã«ã€‚ä»Šã™ãç‰¹åˆ¥å‰²å¼•ã‚’ã‚²ãƒƒãƒˆï¼'
            ];

            html += '<div class="debug-result">';
            html += '<strong>æ¨¡æ‹Ÿäº§å“ä¿¡æ¯:</strong><br>';
            html += `äº§å“åç§°: ${productInfo.name}<br>`;
            html += `äº§å“ç‰¹æ€§: ${productInfo.features}<br>`;
            html += `ç›®æ ‡å—ä¼—: ${productInfo.targetAudience}<br><br>`;
            html += '</div>';

            templates.forEach((template, index) => {
                // ç¬¬ä¸€æ­¥ï¼šæ›¿æ¢å˜é‡
                let step1 = template
                    .replace('{product}', productInfo.name)
                    .replace('{features}', productInfo.features)
                    .replace('{audience}', productInfo.targetAudience);

                // ç¬¬äºŒæ­¥ï¼šæ¸…ç†å­—ç¬¦
                let step2 = cleanEmojis(step1);

                const hasReplacementChar = step2.includes('');
                const status = hasReplacementChar ? 'âŒ å¤±è´¥' : 'âœ… æˆåŠŸ';
                const statusClass = hasReplacementChar ? 'error' : 'success';

                html += `
                    <div class="debug-result ${statusClass}">
                        <strong>æ–‡æ¡ˆ ${index + 1}:</strong> ${status}<br>
                        <strong>æ­¥éª¤1 - å˜é‡æ›¿æ¢:</strong> ${step1}<br>
                        <strong>æ­¥éª¤2 - å­—ç¬¦æ¸…ç†:</strong> ${step2}<br>
                        <strong>åŒ…å«æ›¿æ¢å­—ç¬¦:</strong> ${hasReplacementChar ? 'æ˜¯' : 'å¦'}
                    </div>
                `;
            });

            resultDiv.innerHTML = html;
        }

        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨è¿è¡Œæµ‹è¯•
        window.onload = function() {
            console.log('ğŸ” å¼€å§‹emojié—®é¢˜è°ƒè¯•...');
            analyzeCharacters();
            testJapaneseTemplates();
            simulateCopyGeneration();
        };
    </script>
</body>
</html>
