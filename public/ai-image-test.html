<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI图片生成测试</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50">
    <div class="min-h-screen py-20">
        <div class="max-w-4xl mx-auto px-4">
            <h1 class="text-3xl font-bold text-center mb-8">AI图片生成测试</h1>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <!-- 测试1: 简单SVG生成 -->
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h3 class="text-lg font-semibold mb-4">测试1: 简单SVG生成</h3>
                    <button id="test1" class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 mb-4">
                        生成测试图片
                    </button>
                    <div id="result1" class="border rounded p-4 min-h-[200px] flex items-center justify-center">
                        点击按钮生成图片
                    </div>
                </div>

                <!-- 测试2: Base64编码 -->
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h3 class="text-lg font-semibold mb-4">测试2: Base64编码</h3>
                    <button id="test2" class="px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600 mb-4">
                        测试编码
                    </button>
                    <div id="result2" class="border rounded p-4 min-h-[200px] flex items-center justify-center">
                        点击按钮测试编码
                    </div>
                </div>
            </div>

            <!-- 错误日志 -->
            <div class="mt-8 bg-white p-6 rounded-lg shadow-md">
                <h3 class="text-lg font-semibold mb-4">错误日志</h3>
                <div id="errorLog" class="bg-gray-100 p-4 rounded text-sm font-mono max-h-40 overflow-y-auto">
                    等待测试...
                </div>
            </div>
        </div>
    </div>

    <script>
        function log(message) {
            const logDiv = document.getElementById('errorLog');
            const timestamp = new Date().toLocaleTimeString();
            logDiv.innerHTML += `[${timestamp}] ${message}\n`;
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(message);
        }

        // 测试1: 简单SVG生成
        document.getElementById('test1').addEventListener('click', function() {
            log('开始测试1: 简单SVG生成');
            
            try {
                const svg = `
                    <svg width="300" height="200" xmlns="http://www.w3.org/2000/svg">
                        <defs>
                            <linearGradient id="grad1" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#667eea;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#764ba2;stop-opacity:1" />
                            </linearGradient>
                        </defs>
                        <rect width="100%" height="100%" fill="url(#grad1)"/>
                        <circle cx="150" cy="80" r="30" fill="white" opacity="0.3"/>
                        <text x="150" y="140" font-family="Arial, sans-serif" font-size="16" fill="white" text-anchor="middle">
                            Test SVG
                        </text>
                    </svg>
                `;
                
                const encoded = btoa(unescape(encodeURIComponent(svg)));
                const dataUrl = `data:image/svg+xml;base64,${encoded}`;
                
                const resultDiv = document.getElementById('result1');
                resultDiv.innerHTML = `<img src="${dataUrl}" alt="测试图片" class="max-w-full h-auto" />`;
                
                log('测试1成功: SVG生成并编码成功');
            } catch (error) {
                log(`测试1失败: ${error.message}`);
                document.getElementById('result1').innerHTML = `<div class="text-red-500">错误: ${error.message}</div>`;
            }
        });

        // 测试2: Base64编码
        document.getElementById('test2').addEventListener('click', function() {
            log('开始测试2: Base64编码');
            
            try {
                const testString = 'Hello World! 你好世界！';
                log(`测试字符串: ${testString}`);
                
                // 方法1: 直接编码
                try {
                    const encoded1 = btoa(testString);
                    log(`方法1成功: ${encoded1}`);
                } catch (error) {
                    log(`方法1失败: ${error.message}`);
                }
                
                // 方法2: 使用encodeURIComponent
                try {
                    const encoded2 = btoa(unescape(encodeURIComponent(testString)));
                    log(`方法2成功: ${encoded2}`);
                } catch (error) {
                    log(`方法2失败: ${error.message}`);
                }
                
                // 方法3: 使用TextEncoder
                try {
                    const encoder = new TextEncoder();
                    const bytes = encoder.encode(testString);
                    let binary = '';
                    for (let i = 0; i < bytes.length; i++) {
                        binary += String.fromCharCode(bytes[i]);
                    }
                    const encoded3 = btoa(binary);
                    log(`方法3成功: ${encoded3}`);
                } catch (error) {
                    log(`方法3失败: ${error.message}`);
                }
                
                document.getElementById('result2').innerHTML = `<div class="text-green-500">编码测试完成，请查看日志</div>`;
                log('测试2完成');
            } catch (error) {
                log(`测试2失败: ${error.message}`);
                document.getElementById('result2').innerHTML = `<div class="text-red-500">错误: ${error.message}</div>`;
            }
        });

        // 页面加载完成
        window.addEventListener('load', function() {
            log('页面加载完成，开始测试...');
        });
    </script>
</body>
</html>
