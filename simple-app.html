<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çˆ†æ¬¾ Facebook å¹¿å‘Šæ–‡æ¡ˆç”Ÿæˆå™¨</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .loading-spinner {
            border: 2px solid #f3f3f3;
            border-top: 2px solid #3498db;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="min-h-screen bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50">
        <!-- Header -->
        <div class="bg-gradient-to-r from-blue-600 via-purple-600 to-pink-600 text-white py-8">
            <div class="container mx-auto px-4">
                <div class="flex items-center justify-center">
                    <div class="text-center">
                        <h1 class="text-4xl font-bold mb-2">ğŸ¯ çˆ†æ¬¾ Facebook å¹¿å‘Šæ–‡æ¡ˆç”Ÿæˆå™¨</h1>
                        <p class="text-xl opacity-90">ä¸“ä¸šçš„å¹¿å‘Šæ–‡æ¡ˆç”Ÿæˆå·¥å…·ï¼Œæ”¯æŒå¤šè¯­è¨€å’Œå¤šç§æ–‡æ¡ˆé£æ ¼</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="container mx-auto px-4 py-8">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <!-- Left: Product Info Input -->
                <div class="lg:col-span-1">
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h2 class="text-2xl font-bold text-gray-900 mb-6">äº§å“ä¿¡æ¯</h2>
                        
                        <form id="productForm" class="space-y-6">
                            <!-- äº§å“åç§° -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    äº§å“åç§° *
                                </label>
                                <input
                                    type="text"
                                    id="productName"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                    placeholder="ä¾‹å¦‚ï¼šè½»ä¾¿æŠ˜å ç”µåŠ¨æ»‘æ¿è½¦"
                                    required
                                />
                            </div>

                            <!-- äº§å“ç‰¹æ€§ -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    äº§å“ç‰¹æ€§ *
                                </label>
                                <textarea
                                    id="productFeatures"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none"
                                    rows="4"
                                    placeholder="æè¿°äº§å“çš„ä¸»è¦ç‰¹ç‚¹å’Œä¼˜åŠ¿"
                                    required
                                ></textarea>
                            </div>

                            <!-- å—ä¼—äººç¾¤ -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    å—ä¼—äººç¾¤ *
                                </label>
                                <input
                                    type="text"
                                    id="targetAudience"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                    placeholder="ä¾‹å¦‚ï¼šå¹´è½»ä¸Šç­æ—ã€æˆ·å¤–çˆ±å¥½è€…"
                                    required
                                />
                            </div>

                            <!-- æŠ•æ”¾åœ°åŒº -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    æŠ•æ”¾åœ°åŒº *
                                </label>
                                <select
                                    id="region"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                    required
                                >
                                    <option value="">è¯·é€‰æ‹©</option>
                                    <option value="CN">ğŸ‡¨ğŸ‡³ ä¸­å›½</option>
                                    <option value="US">ğŸ‡ºğŸ‡¸ ç¾å›½</option>
                                    <option value="JP">ğŸ‡¯ğŸ‡µ æ—¥æœ¬</option>
                                    <option value="KR">ğŸ‡°ğŸ‡· éŸ©å›½</option>
                                </select>
                            </div>

                            <!-- ç”ŸæˆæŒ‰é’® -->
                            <button
                                type="submit"
                                id="generateBtn"
                                class="w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white py-3 px-6 rounded-lg font-semibold hover:from-blue-700 hover:to-purple-700 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed"
                            >
                                ç”Ÿæˆå¹¿å‘Šæ–‡æ¡ˆ
                            </button>
                        </form>
                    </div>
                </div>

                <!-- Right: Generated Results -->
                <div class="lg:col-span-2">
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h2 class="text-2xl font-bold text-gray-900 mb-6">ç”Ÿæˆç»“æœ</h2>
                        
                        <div id="loadingSection" class="text-center py-8" style="display: none;">
                            <div class="loading-spinner mx-auto"></div>
                            <p class="mt-2 text-gray-600">æ­£åœ¨ç”Ÿæˆæ–‡æ¡ˆ...</p>
                        </div>
                        
                        <div id="resultsSection" class="space-y-6" style="display: none;">
                            <!-- Results will be inserted here -->
                        </div>
                        
                        <div id="emptySection" class="text-center py-8 text-gray-500">
                            <p>å¡«å†™äº§å“ä¿¡æ¯å¹¶ç‚¹å‡»ç”ŸæˆæŒ‰é’®å¼€å§‹åˆ›å»ºå¹¿å‘Šæ–‡æ¡ˆ</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="bg-gray-900 text-white py-8 mt-16">
            <div class="container mx-auto px-4 text-center">
                <p class="text-sm opacity-75">
                    Â© 2024 çˆ†æ¬¾æ–‡æ¡ˆç”Ÿæˆå™¨ - ä¸“ä¸šçš„Facebookå¹¿å‘Šæ–‡æ¡ˆç”Ÿæˆå·¥å…·
                </p>
            </div>
        </div>
    </div>

    <script>
        // åœ°åŒºè¯­è¨€é…ç½®
        const regionConfig = {
            'CN': {
                language: 'zh-CN',
                name: 'ä¸­å›½',
                flag: 'ğŸ‡¨ğŸ‡³',
                templates: [
                    'ğŸš€ {product} - æ”¹å˜ä½ çš„ç”Ÿæ´»ï¼',
                    'ğŸ’¡ å‘ç° {product} çš„ç‹¬ç‰¹é­…åŠ›',
                    'ğŸ”¥ é™æ—¶ä¼˜æƒ ï¼š{product} ç­‰ä½ æ¥ä½“éªŒï¼'
                ]
            },
            'US': {
                language: 'en-US',
                name: 'ç¾å›½',
                flag: 'ğŸ‡ºğŸ‡¸',
                templates: [
                    'ğŸš€ Transform your life with {product}!',
                    'ğŸ’¡ Discover the unique charm of {product}',
                    'ğŸ”¥ Limited time offer: {product} awaits you!'
                ]
            },
            'JP': {
                language: 'ja-JP',
                name: 'æ—¥æœ¬',
                flag: 'ğŸ‡¯ğŸ‡µ',
                templates: [
                    'ğŸš€ {product}ã§äººç”Ÿã‚’å¤‰ãˆã‚ˆã†ï¼',
                    'ğŸ’¡ {product}ã®ç‹¬ç‰¹ãªé­…åŠ›ã‚’ç™ºè¦‹',
                    'ğŸ”¥ æœŸé–“é™å®šã‚ªãƒ•ã‚¡ãƒ¼ï¼š{product}ã‚’ãŠæ¥½ã—ã¿ãã ã•ã„ï¼'
                ]
            },
            'KR': {
                language: 'ko-KR',
                name: 'éŸ©å›½',
                flag: 'ğŸ‡°ğŸ‡·',
                templates: [
                    'ğŸš€ {product}ë¡œ ì¸ìƒì„ ë°”ê¿”ë³´ì„¸ìš”!',
                    'ğŸ’¡ {product}ì˜ ë…íŠ¹í•œ ë§¤ë ¥ì„ ë°œê²¬í•˜ì„¸ìš”',
                    'ğŸ”¥ í•œì • ì‹œê°„ íŠ¹ê°€: {product}ê°€ ì—¬ëŸ¬ë¶„ì„ ê¸°ë‹¤ë¦½ë‹ˆë‹¤!'
                ]
            }
        };

        // ç”Ÿæˆå¯¹åº”è¯­è¨€çš„æ–‡æ¡ˆ
        function generateCopies(productName, region) {
            const config = regionConfig[region];
            if (!config) {
                return [
                    `ğŸš€ ${productName} - æ”¹å˜ä½ çš„ç”Ÿæ´»ï¼`,
                    `ğŸ’¡ å‘ç° ${productName} çš„ç‹¬ç‰¹é­…åŠ›`,
                    `ğŸ”¥ é™æ—¶ä¼˜æƒ ï¼š${productName} ç­‰ä½ æ¥ä½“éªŒï¼`
                ];
            }

            return config.templates.map(template => 
                template.replace('{product}', productName)
            );
        }

        // æ•ˆæœé¢„æµ‹å‡½æ•°
        async function predictEffect(copyText, region) {
            try {
                console.log('ğŸ¯ å¼€å§‹æ•ˆæœé¢„æµ‹ï¼Œæ–‡æ¡ˆ:', copyText);
                
                const config = regionConfig[region];
                const language = config ? config.language : 'zh-CN';
                
                const response = await fetch('https://api.deepseek.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer sk-674b29e0b86846bca55195b66eb3e3aa'
                    },
                    body: JSON.stringify({
                        model: 'deepseek-chat',
                        messages: [
                            {
                                role: 'system',
                                content: `ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„Facebookå¹¿å‘Šæ•ˆæœé¢„æµ‹ä¸“å®¶ï¼Œèƒ½å¤Ÿå‡†ç¡®è¯„ä¼°å¹¿å‘Šæ–‡æ¡ˆçš„è¥é”€æ•ˆæœã€‚è¯·åŸºäºæ–‡æ¡ˆçš„å¸å¼•åŠ›ã€æƒ…æ„Ÿå…±é¸£ã€å·å¬æ€§è¯­è¨€ç­‰å› ç´ è¿›è¡Œè¯„åˆ†ã€‚è¯·ç”¨${language === 'zh-CN' ? 'ä¸­æ–‡' : language === 'en-US' ? 'è‹±æ–‡' : language === 'ja-JP' ? 'æ—¥æ–‡' : 'éŸ©æ–‡'}å›å¤ã€‚`
                            },
                            {
                                role: 'user',
                                content: `è¯·å¯¹ä»¥ä¸‹ Facebook å¹¿å‘Šæ–‡æ¡ˆè¿›è¡Œè¥é”€æ•ˆæœé¢„æµ‹ï¼Œè¾“å‡ºæ ¼å¼å¦‚ä¸‹ï¼š
- é¢„ä¼°ç‚¹å‡»ç‡ï¼ˆCTRï¼‰ç™¾åˆ†æ¯”ï¼ˆä¾‹å¦‚ 3.2%ï¼‰
- æ•ˆæœè¯„åˆ†ï¼ˆ1~5æ˜Ÿï¼‰
- ç®€çŸ­ä¼˜åŒ–å»ºè®®

æ–‡æ¡ˆå†…å®¹ï¼šã€${copyText}ã€

è¯·ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹æ ¼å¼è¿”å›ï¼Œä¸è¦æ·»åŠ å…¶ä»–å†…å®¹ï¼š
CTR: [ç™¾åˆ†æ¯”]
è¯„åˆ†: [æ˜Ÿçº§]
å»ºè®®: [ä¸€å¥è¯å»ºè®®]`
                            }
                        ],
                        max_tokens: 200,
                        temperature: 0.3,
                        top_p: 0.9
                    })
                });

                console.log('ğŸ“Š APIå“åº”çŠ¶æ€:', response.status);
                if (!response.ok) {
                    throw new Error(`APIè¯·æ±‚å¤±è´¥: ${response.status}`);
                }

                const data = await response.json();
                console.log('ğŸ“Š APIå“åº”æ•°æ®:', data);
                const content = data.choices[0]?.message?.content;

                if (!content) {
                    throw new Error('AIæœªè¿”å›æœ‰æ•ˆå†…å®¹');
                }

                console.log('ğŸ¤– AIè¿”å›å†…å®¹:', content);
                
                // è§£æç»“æœ
                const lines = content.split('\n').map(line => line.trim()).filter(line => line);
                let ctr = '';
                let rating = '';
                let suggestion = '';
                
                for (const line of lines) {
                    if (line.startsWith('CTR:')) {
                        ctr = line.replace('CTR:', '').trim();
                    } else if (line.startsWith('è¯„åˆ†:')) {
                        rating = line.replace('è¯„åˆ†:', '').trim();
                    } else if (line.startsWith('å»ºè®®:')) {
                        suggestion = line.replace('å»ºè®®:', '').trim();
                    }
                }
                
                console.log('ğŸ“Š è§£æç»“æœ:', { ctr, rating, suggestion });
                
                if (!ctr || !rating || !suggestion) {
                    console.warn('âš ï¸ æ•ˆæœé¢„æµ‹ç»“æœæ ¼å¼ä¸å®Œæ•´');
                    return null;
                }
                
                return { ctr, rating, suggestion };
            } catch (err) {
                console.error('ğŸ’¥ æ•ˆæœé¢„æµ‹é”™è¯¯:', err);
                return null;
            }
        }

        // ç”Ÿæˆæ–‡æ¡ˆå¹¶é¢„æµ‹æ•ˆæœ
        async function handleGenerate() {
            const productName = document.getElementById('productName').value;
            const productFeatures = document.getElementById('productFeatures').value;
            const targetAudience = document.getElementById('targetAudience').value;
            const region = document.getElementById('region').value;

            if (!productName || !productFeatures || !targetAudience || !region) {
                alert('è¯·å¡«å†™æ‰€æœ‰å¿…å¡«å­—æ®µ');
                return;
            }

            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            document.getElementById('loadingSection').style.display = 'block';
            document.getElementById('resultsSection').style.display = 'none';
            document.getElementById('emptySection').style.display = 'none';
            document.getElementById('generateBtn').disabled = true;
            document.getElementById('generateBtn').textContent = 'ç”Ÿæˆä¸­...';

            try {
                console.log('ğŸš€ å¼€å§‹ç”Ÿæˆæ–‡æ¡ˆ...');
                console.log('ğŸŒ é€‰æ‹©çš„åœ°åŒº:', region, regionConfig[region]?.name);
                
                // æ¨¡æ‹Ÿç”Ÿæˆè¿‡ç¨‹
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                // æ ¹æ®åœ°åŒºç”Ÿæˆå¯¹åº”è¯­è¨€çš„æ–‡æ¡ˆ
                const copies = generateCopies(productName, region);
                
                console.log('ğŸ“ ç”Ÿæˆçš„æ–‡æ¡ˆ:', copies);
                
                // ä¸ºæ¯ä¸ªæ–‡æ¡ˆç”Ÿæˆæ•ˆæœé¢„æµ‹
                console.log('ğŸ¯ å¼€å§‹æ•ˆæœé¢„æµ‹...');
                const predictions = [];
                
                for (let i = 0; i < copies.length; i++) {
                    const copy = copies[i];
                    console.log(`ğŸ“Š æ­£åœ¨é¢„æµ‹ç¬¬ ${i + 1} æ¡æ–‡æ¡ˆ:`, copy.substring(0, 50) + '...');
                    
                    const prediction = await predictEffect(copy, region);
                    if (prediction) {
                        console.log(`âœ… ç¬¬ ${i + 1} æ¡æ–‡æ¡ˆé¢„æµ‹æˆåŠŸ:`, prediction);
                        predictions.push(prediction);
                    } else {
                        console.log(`âš ï¸ ç¬¬ ${i + 1} æ¡æ–‡æ¡ˆé¢„æµ‹å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤å€¼`);
                        predictions.push({
                            ctr: '2.5%',
                            rating: 'â˜…â˜…â˜…â˜†â˜†',
                            suggestion: 'å»ºè®®ä¼˜åŒ–æ–‡æ¡ˆç»“æ„ï¼Œå¢åŠ æƒ…æ„Ÿå…±é¸£å…ƒç´ '
                        });
                    }
                }
                
                console.log('ğŸ‰ æ‰€æœ‰é¢„æµ‹å®Œæˆï¼Œè®¾ç½®é¢„æµ‹ç»“æœ:', predictions);
                
                // æ˜¾ç¤ºç»“æœ
                displayResults(copies, predictions, region);
                
            } catch (err) {
                console.error('ğŸ’¥ ç”Ÿæˆè¿‡ç¨‹å‡ºé”™:', err);
                alert('ç”Ÿæˆè¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯ï¼Œè¯·é‡è¯•');
            } finally {
                document.getElementById('loadingSection').style.display = 'none';
                document.getElementById('generateBtn').disabled = false;
                document.getElementById('generateBtn').textContent = 'ç”Ÿæˆå¹¿å‘Šæ–‡æ¡ˆ';
            }
        }

        // æ˜¾ç¤ºç»“æœ
        function displayResults(copies, predictions, region) {
            const resultsSection = document.getElementById('resultsSection');
            const config = regionConfig[region];
            resultsSection.innerHTML = '';
            
            copies.forEach((copy, index) => {
                const prediction = predictions[index];
                const copyDiv = document.createElement('div');
                copyDiv.className = 'bg-gradient-to-r from-green-50 to-blue-50 border border-green-200 rounded-lg p-4';
                copyDiv.innerHTML = `
                    <div class="flex items-start justify-between mb-3">
                        <div class="flex-1">
                            <p class="text-gray-800 leading-relaxed">${copy}</p>
                            ${config ? `<p class="text-xs text-gray-500 mt-1">${config.flag} ${config.name}åœ°åŒº</p>` : ''}
                        </div>
                        <button
                            onclick="navigator.clipboard.writeText('${copy}')"
                            class="ml-4 px-3 py-1 bg-blue-600 text-white text-sm rounded hover:bg-blue-700 transition-colors"
                        >
                            å¤åˆ¶
                        </button>
                    </div>
                    
                    ${prediction ? `
                    <div class="mt-4 p-4 bg-white/80 rounded-lg border border-green-100">
                        <div class="flex items-center mb-3">
                            <span class="text-sm font-semibold text-green-800">ğŸ“Š æ•ˆæœé¢„æµ‹</span>
                        </div>
                        
                        <div class="grid grid-cols-1 sm:grid-cols-3 gap-3">
                            <div class="bg-gray-50 rounded-lg p-3">
                                <div class="flex items-center mb-1">
                                    <span class="text-xs font-medium text-gray-700">é¢„ä¼°ç‚¹å‡»ç‡</span>
                                </div>
                                <div class="text-base font-bold text-blue-600">${prediction.ctr}</div>
                            </div>

                            <div class="bg-gray-50 rounded-lg p-3">
                                <div class="flex items-center mb-1">
                                    <span class="text-xs font-medium text-gray-700">æ•ˆæœè¯„åˆ†</span>
                                </div>
                                <div class="text-base font-bold text-yellow-600">${prediction.rating}</div>
                            </div>

                            <div class="bg-gray-50 rounded-lg p-3 sm:col-span-1">
                                <div class="flex items-center mb-1">
                                    <span class="text-xs font-medium text-gray-700">ä¼˜åŒ–å»ºè®®</span>
                                </div>
                                <div class="text-xs text-gray-700 leading-relaxed">${prediction.suggestion}</div>
                            </div>
                        </div>
                    </div>
                    ` : ''}
                `;
                resultsSection.appendChild(copyDiv);
            });
            
            resultsSection.style.display = 'block';
        }

        // ç»‘å®šè¡¨å•æäº¤äº‹ä»¶
        document.getElementById('productForm').addEventListener('submit', function(e) {
            e.preventDefault();
            handleGenerate();
        });
    </script>
</body>
</html>
