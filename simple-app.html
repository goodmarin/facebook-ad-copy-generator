<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>爆款 Facebook 广告文案生成器</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .loading-spinner {
            border: 2px solid #f3f3f3;
            border-top: 2px solid #3498db;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="min-h-screen bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50">
        <!-- Header -->
        <div class="bg-gradient-to-r from-blue-600 via-purple-600 to-pink-600 text-white py-8">
            <div class="container mx-auto px-4">
                <div class="flex items-center justify-center">
                    <div class="text-center">
                        <h1 class="text-4xl font-bold mb-2">🎯 爆款 Facebook 广告文案生成器</h1>
                        <p class="text-xl opacity-90">专业的广告文案生成工具，支持多语言和多种文案风格</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="container mx-auto px-4 py-8">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <!-- Left: Product Info Input -->
                <div class="lg:col-span-1">
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h2 class="text-2xl font-bold text-gray-900 mb-6">产品信息</h2>
                        
                        <form id="productForm" class="space-y-6">
                            <!-- 产品名称 -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    产品名称 *
                                </label>
                                <input
                                    type="text"
                                    id="productName"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                    placeholder="例如：轻便折叠电动滑板车"
                                    required
                                />
                            </div>

                            <!-- 产品特性 -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    产品特性 *
                                </label>
                                <textarea
                                    id="productFeatures"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none"
                                    rows="4"
                                    placeholder="描述产品的主要特点和优势"
                                    required
                                ></textarea>
                            </div>

                            <!-- 受众人群 -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    受众人群 *
                                </label>
                                <input
                                    type="text"
                                    id="targetAudience"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                    placeholder="例如：年轻上班族、户外爱好者"
                                    required
                                />
                            </div>

                            <!-- 投放地区 -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    投放地区 *
                                </label>
                                <select
                                    id="region"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                    required
                                >
                                    <option value="">请选择</option>
                                    <option value="CN">🇨🇳 中国</option>
                                    <option value="US">🇺🇸 美国</option>
                                    <option value="JP">🇯🇵 日本</option>
                                    <option value="KR">🇰🇷 韩国</option>
                                </select>
                            </div>

                            <!-- 生成按钮 -->
                            <button
                                type="submit"
                                id="generateBtn"
                                class="w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white py-3 px-6 rounded-lg font-semibold hover:from-blue-700 hover:to-purple-700 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed"
                            >
                                生成广告文案
                            </button>
                        </form>
                    </div>
                </div>

                <!-- Right: Generated Results -->
                <div class="lg:col-span-2">
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h2 class="text-2xl font-bold text-gray-900 mb-6">生成结果</h2>
                        
                        <div id="loadingSection" class="text-center py-8" style="display: none;">
                            <div class="loading-spinner mx-auto"></div>
                            <p class="mt-2 text-gray-600">正在生成文案...</p>
                        </div>
                        
                        <div id="resultsSection" class="space-y-6" style="display: none;">
                            <!-- Results will be inserted here -->
                        </div>
                        
                        <div id="emptySection" class="text-center py-8 text-gray-500">
                            <p>填写产品信息并点击生成按钮开始创建广告文案</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="bg-gray-900 text-white py-8 mt-16">
            <div class="container mx-auto px-4 text-center">
                <p class="text-sm opacity-75">
                    © 2024 爆款文案生成器 - 专业的Facebook广告文案生成工具
                </p>
            </div>
        </div>
    </div>

    <script>
        // 地区语言配置
        const regionConfig = {
            'CN': {
                language: 'zh-CN',
                name: '中国',
                flag: '🇨🇳',
                templates: [
                    '🚀 {product} - 改变你的生活！',
                    '💡 发现 {product} 的独特魅力',
                    '🔥 限时优惠：{product} 等你来体验！'
                ]
            },
            'US': {
                language: 'en-US',
                name: '美国',
                flag: '🇺🇸',
                templates: [
                    '🚀 Transform your life with {product}!',
                    '💡 Discover the unique charm of {product}',
                    '🔥 Limited time offer: {product} awaits you!'
                ]
            },
            'JP': {
                language: 'ja-JP',
                name: '日本',
                flag: '🇯🇵',
                templates: [
                    '🚀 {product}で人生を変えよう！',
                    '💡 {product}の独特な魅力を発見',
                    '🔥 期間限定オファー：{product}をお楽しみください！'
                ]
            },
            'KR': {
                language: 'ko-KR',
                name: '韩国',
                flag: '🇰🇷',
                templates: [
                    '🚀 {product}로 인생을 바꿔보세요!',
                    '💡 {product}의 독특한 매력을 발견하세요',
                    '🔥 한정 시간 특가: {product}가 여러분을 기다립니다!'
                ]
            }
        };

        // 生成对应语言的文案
        function generateCopies(productName, region) {
            const config = regionConfig[region];
            if (!config) {
                return [
                    `🚀 ${productName} - 改变你的生活！`,
                    `💡 发现 ${productName} 的独特魅力`,
                    `🔥 限时优惠：${productName} 等你来体验！`
                ];
            }

            return config.templates.map(template => 
                template.replace('{product}', productName)
            );
        }

        // 效果预测函数
        async function predictEffect(copyText, region) {
            try {
                console.log('🎯 开始效果预测，文案:', copyText);
                
                const config = regionConfig[region];
                const language = config ? config.language : 'zh-CN';
                
                const response = await fetch('https://api.deepseek.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer sk-674b29e0b86846bca55195b66eb3e3aa'
                    },
                    body: JSON.stringify({
                        model: 'deepseek-chat',
                        messages: [
                            {
                                role: 'system',
                                content: `你是一个专业的Facebook广告效果预测专家，能够准确评估广告文案的营销效果。请基于文案的吸引力、情感共鸣、号召性语言等因素进行评分。请用${language === 'zh-CN' ? '中文' : language === 'en-US' ? '英文' : language === 'ja-JP' ? '日文' : '韩文'}回复。`
                            },
                            {
                                role: 'user',
                                content: `请对以下 Facebook 广告文案进行营销效果预测，输出格式如下：
- 预估点击率（CTR）百分比（例如 3.2%）
- 效果评分（1~5星）
- 简短优化建议

文案内容：『${copyText}』

请严格按照以下格式返回，不要添加其他内容：
CTR: [百分比]
评分: [星级]
建议: [一句话建议]`
                            }
                        ],
                        max_tokens: 200,
                        temperature: 0.3,
                        top_p: 0.9
                    })
                });

                console.log('📊 API响应状态:', response.status);
                if (!response.ok) {
                    throw new Error(`API请求失败: ${response.status}`);
                }

                const data = await response.json();
                console.log('📊 API响应数据:', data);
                const content = data.choices[0]?.message?.content;

                if (!content) {
                    throw new Error('AI未返回有效内容');
                }

                console.log('🤖 AI返回内容:', content);
                
                // 解析结果
                const lines = content.split('\n').map(line => line.trim()).filter(line => line);
                let ctr = '';
                let rating = '';
                let suggestion = '';
                
                for (const line of lines) {
                    if (line.startsWith('CTR:')) {
                        ctr = line.replace('CTR:', '').trim();
                    } else if (line.startsWith('评分:')) {
                        rating = line.replace('评分:', '').trim();
                    } else if (line.startsWith('建议:')) {
                        suggestion = line.replace('建议:', '').trim();
                    }
                }
                
                console.log('📊 解析结果:', { ctr, rating, suggestion });
                
                if (!ctr || !rating || !suggestion) {
                    console.warn('⚠️ 效果预测结果格式不完整');
                    return null;
                }
                
                return { ctr, rating, suggestion };
            } catch (err) {
                console.error('💥 效果预测错误:', err);
                return null;
            }
        }

        // 生成文案并预测效果
        async function handleGenerate() {
            const productName = document.getElementById('productName').value;
            const productFeatures = document.getElementById('productFeatures').value;
            const targetAudience = document.getElementById('targetAudience').value;
            const region = document.getElementById('region').value;

            if (!productName || !productFeatures || !targetAudience || !region) {
                alert('请填写所有必填字段');
                return;
            }

            // 显示加载状态
            document.getElementById('loadingSection').style.display = 'block';
            document.getElementById('resultsSection').style.display = 'none';
            document.getElementById('emptySection').style.display = 'none';
            document.getElementById('generateBtn').disabled = true;
            document.getElementById('generateBtn').textContent = '生成中...';

            try {
                console.log('🚀 开始生成文案...');
                console.log('🌍 选择的地区:', region, regionConfig[region]?.name);
                
                // 模拟生成过程
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                // 根据地区生成对应语言的文案
                const copies = generateCopies(productName, region);
                
                console.log('📝 生成的文案:', copies);
                
                // 为每个文案生成效果预测
                console.log('🎯 开始效果预测...');
                const predictions = [];
                
                for (let i = 0; i < copies.length; i++) {
                    const copy = copies[i];
                    console.log(`📊 正在预测第 ${i + 1} 条文案:`, copy.substring(0, 50) + '...');
                    
                    const prediction = await predictEffect(copy, region);
                    if (prediction) {
                        console.log(`✅ 第 ${i + 1} 条文案预测成功:`, prediction);
                        predictions.push(prediction);
                    } else {
                        console.log(`⚠️ 第 ${i + 1} 条文案预测失败，使用默认值`);
                        predictions.push({
                            ctr: '2.5%',
                            rating: '★★★☆☆',
                            suggestion: '建议优化文案结构，增加情感共鸣元素'
                        });
                    }
                }
                
                console.log('🎉 所有预测完成，设置预测结果:', predictions);
                
                // 显示结果
                displayResults(copies, predictions, region);
                
            } catch (err) {
                console.error('💥 生成过程出错:', err);
                alert('生成过程中发生错误，请重试');
            } finally {
                document.getElementById('loadingSection').style.display = 'none';
                document.getElementById('generateBtn').disabled = false;
                document.getElementById('generateBtn').textContent = '生成广告文案';
            }
        }

        // 显示结果
        function displayResults(copies, predictions, region) {
            const resultsSection = document.getElementById('resultsSection');
            const config = regionConfig[region];
            resultsSection.innerHTML = '';
            
            copies.forEach((copy, index) => {
                const prediction = predictions[index];
                const copyDiv = document.createElement('div');
                copyDiv.className = 'bg-gradient-to-r from-green-50 to-blue-50 border border-green-200 rounded-lg p-4';
                copyDiv.innerHTML = `
                    <div class="flex items-start justify-between mb-3">
                        <div class="flex-1">
                            <p class="text-gray-800 leading-relaxed">${copy}</p>
                            ${config ? `<p class="text-xs text-gray-500 mt-1">${config.flag} ${config.name}地区</p>` : ''}
                        </div>
                        <button
                            onclick="navigator.clipboard.writeText('${copy}')"
                            class="ml-4 px-3 py-1 bg-blue-600 text-white text-sm rounded hover:bg-blue-700 transition-colors"
                        >
                            复制
                        </button>
                    </div>
                    
                    ${prediction ? `
                    <div class="mt-4 p-4 bg-white/80 rounded-lg border border-green-100">
                        <div class="flex items-center mb-3">
                            <span class="text-sm font-semibold text-green-800">📊 效果预测</span>
                        </div>
                        
                        <div class="grid grid-cols-1 sm:grid-cols-3 gap-3">
                            <div class="bg-gray-50 rounded-lg p-3">
                                <div class="flex items-center mb-1">
                                    <span class="text-xs font-medium text-gray-700">预估点击率</span>
                                </div>
                                <div class="text-base font-bold text-blue-600">${prediction.ctr}</div>
                            </div>

                            <div class="bg-gray-50 rounded-lg p-3">
                                <div class="flex items-center mb-1">
                                    <span class="text-xs font-medium text-gray-700">效果评分</span>
                                </div>
                                <div class="text-base font-bold text-yellow-600">${prediction.rating}</div>
                            </div>

                            <div class="bg-gray-50 rounded-lg p-3 sm:col-span-1">
                                <div class="flex items-center mb-1">
                                    <span class="text-xs font-medium text-gray-700">优化建议</span>
                                </div>
                                <div class="text-xs text-gray-700 leading-relaxed">${prediction.suggestion}</div>
                            </div>
                        </div>
                    </div>
                    ` : ''}
                `;
                resultsSection.appendChild(copyDiv);
            });
            
            resultsSection.style.display = 'block';
        }

        // 绑定表单提交事件
        document.getElementById('productForm').addEventListener('submit', function(e) {
            e.preventDefault();
            handleGenerate();
        });
    </script>
</body>
</html>
