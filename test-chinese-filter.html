<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>中文字符过滤测试</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .test-section {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
            backdrop-filter: blur(10px);
        }
        .test-input {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: none;
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.9);
            color: #333;
        }
        .test-button {
            background: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px 5px;
        }
        .test-button:hover {
            background: #45a049;
        }
        .result {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            white-space: pre-wrap;
            font-family: monospace;
        }
        .error {
            background: rgba(255, 0, 0, 0.3);
            border-left: 4px solid #ff0000;
        }
        .success {
            background: rgba(0, 255, 0, 0.3);
            border-left: 4px solid #00ff00;
        }
    </style>
</head>
<body>
    <h1>🧪 中文字符过滤测试</h1>
    
    <div class="test-section">
        <h2>🔍 测试用例</h2>
        <p>这个测试页面用于验证中文字符过滤功能是否正常工作。我们将测试不同语言和地区的文案生成。</p>
        
        <h3>测试输入：</h3>
        <input type="text" id="productName" class="test-input" value="智能投资产品" placeholder="产品名称">
        <input type="text" id="productFeatures" class="test-input" value="高收益、低风险、智能管理" placeholder="产品特性">
        <input type="text" id="targetAudience" class="test-input" value="上班族" placeholder="目标受众">
        
        <h3>测试地区：</h3>
        <select id="testRegion" class="test-input">
            <option value="US">美国 (English)</option>
            <option value="JP">日本 (Japanese)</option>
            <option value="KR">韩国 (Korean)</option>
            <option value="CN">中国 (Simplified Chinese)</option>
        </select>
        
        <button onclick="testChineseFilter()" class="test-button">🧪 测试中文字符过滤</button>
        <button onclick="clearResults()" class="test-button">🗑️ 清除结果</button>
    </div>
    
    <div class="test-section">
        <h2>📊 测试结果</h2>
        <div id="testResults"></div>
    </div>

    <script>
        // 模拟文案本地化处理函数
        function processCopyForLocalization(copy, language, region) {
            let processedCopy = copy;
            
            // 根据语言进行特定的清理
            switch (language) {
                case 'English':
                    // 英语：移除所有非英语字符，只保留英文、数字、英文标点和安全emoji
                    processedCopy = processedCopy.replace(/[^\x00-\x7F\s]/g, char => {
                        return isSafeEmoji(char) ? char : '';
                    });
                    processedCopy = processedCopy.replace(/\s+/g, ' ').trim();
                    break;
                    
                case 'Japanese':
                    // 日语：保留日语字符（平假名、片假名）、英文、数字、日文标点和安全emoji，移除中文字符
                    processedCopy = processedCopy.replace(/[\u4E00-\u9FFF]/g, ''); // 移除所有中文字符
                    processedCopy = processedCopy.replace(/[^\x00-\x7F\u3040-\u309F\u30A0-\u30FF\uFF00-\uFFEF\s]/g, char => {
                        return isSafeEmoji(char) ? char : '';
                    });
                    // 移除中文标点，保留日文标点
                    processedCopy = processedCopy.replace(/[，。！？；：""''（）【】]/g, '');
                    processedCopy = processedCopy.replace(/\s+/g, ' ').trim();
                    break;
                    
                case 'Korean':
                    // 韩语：保留韩语字符（谚文）、英文、数字、韩文标点和安全emoji，移除中文字符
                    processedCopy = processedCopy.replace(/[\u4E00-\u9FFF]/g, ''); // 移除所有中文字符
                    processedCopy = processedCopy.replace(/[^\x00-\x7F\uAC00-\uD7AF\uFF00-\uFFEF\s]/g, char => {
                        return isSafeEmoji(char) ? char : '';
                    });
                    // 移除中文标点，保留韩文标点
                    processedCopy = processedCopy.replace(/[，。！？；：""''（）【】]/g, '');
                    processedCopy = processedCopy.replace(/\s+/g, ' ').trim();
                    break;
                    
                case 'Simplified Chinese':
                case 'Traditional Chinese':
                    // 中文：保留中文字符、英文、数字、中文标点和安全emoji
                    processedCopy = processedCopy.replace(/[^\x00-\x7F\u4E00-\u9FFF\uFF00-\uFFEF\s]/g, char => {
                        return isSafeEmoji(char) ? char : '';
                    });
                    processedCopy = processedCopy.replace(/\s+/g, ' ').trim();
                    break;
                    
                default:
                    // 默认情况：移除所有中文字符，只保留英文、数字、标点和安全emoji
                    processedCopy = processedCopy.replace(/[\u4E00-\u9FFF]/g, ''); // 移除所有中文字符
                    processedCopy = processedCopy.replace(/[^\x00-\x7F\uFF00-\uFFEF\s]/g, char => {
                        return isSafeEmoji(char) ? char : '';
                    });
                    processedCopy = processedCopy.replace(/[，。！？；：""''（）【】]/g, '');
                    processedCopy = processedCopy.replace(/\s+/g, ' ').trim();
                    break;
            }
            
            return processedCopy;
        }

        // 检查emoji是否安全
        function isSafeEmoji(char) {
            const safeEmojiRanges = [
                [0x1F600, 0x1F64F], // 表情符号
                [0x1F300, 0x1F5FF], // 杂项符号和象形文字
                [0x1F680, 0x1F6FF], // 交通和地图符号
                [0x1F1E0, 0x1F1FF], // 区域指示符号
                [0x2600, 0x26FF],   // 杂项符号
                [0x2700, 0x27BF],   // 装饰符号
                [0xFE00, 0xFE0F],   // 变体选择器
                [0x1F900, 0x1F9FF], // 补充符号和象形文字
                [0x1F018, 0x1F270], // 封闭字母数字补充
            ];
            
            const codePoint = char.codePointAt(0);
            if (!codePoint) return false;
            
            return safeEmojiRanges.some(([start, end]) => codePoint >= start && codePoint <= end);
        }

        // 获取地区语言配置
        function getLanguageAndStyle(region) {
            const regionConfig = {
                'US': { language: 'English', style: 'confident and aspirational' },
                'JP': { language: 'Japanese', style: '丁寧で品質重視' },
                'KR': { language: 'Korean', style: '트렌디하고 스타일리시' },
                'CN': { language: 'Simplified Chinese', style: '专业可靠，注重品质' }
            };
            
            return regionConfig[region] || { language: 'English', style: 'professional and reliable' };
        }

        // 测试中文字符过滤
        function testChineseFilter() {
            const resultsDiv = document.getElementById('testResults');
            const region = document.getElementById('testRegion').value;
            const config = getLanguageAndStyle(region);
            
            // 模拟AI生成的文案（包含中文）
            const testCopies = [
                `✨ Transform your life with Investment Products! ✨ Wealth Building Affordable Investment with Good Returns designed for **上班族**. Experience the **perfect** fusion of technology and lifestyle! ✨`,
                `🎉 投資商品で人生を変えよう! 🎉 資産構築 手頃な投資で良いリターン 🎉 **上班族**のために設計されましたテクノロジーとライフスタイルの完璧な融合を体験しよう! 🎉`,
                `🚀 투자 상품으로 인생을 바꿔보세요! 🚀 자산 구축 합리적인 투자로 좋은 수익 🚀 **上班族**을 위해 설계된 기술과 라이프스타일의 완벽한 융합을 경험하세요! 🚀`
            ];
            
            let results = `<h3>🧪 测试结果 - ${region} (${config.language})</h3>`;
            
            testCopies.forEach((copy, index) => {
                const originalCopy = copy;
                const processedCopy = processCopyForLocalization(copy, config.language, region);
                
                // 检查是否还包含中文字符
                const hasChinese = /[\u4E00-\u9FFF]/.test(processedCopy);
                const hasTargetAudience = processedCopy.includes('上班族');
                
                const status = hasChinese ? '❌ 失败' : '✅ 成功';
                const chineseStatus = hasTargetAudience ? '❌ 仍包含目标受众中文' : '✅ 已过滤目标受众中文';
                
                results += `
<div class="result ${hasChinese ? 'error' : 'success'}">
📝 文案 ${index + 1}:
${status} - ${chineseStatus}

🔍 原始文案:
${originalCopy}

🧹 处理后文案:
${processedCopy}

📊 分析:
- 包含中文字符: ${hasChinese ? '是' : '否'}
- 包含"上班族": ${hasTargetAudience ? '是' : '否'}
- 文案长度: ${processedCopy.length} 字符
</div>`;
            });
            
            resultsDiv.innerHTML = results;
        }

        // 清除结果
        function clearResults() {
            document.getElementById('testResults').innerHTML = '';
        }

        // 页面加载完成后自动运行一次测试
        window.onload = function() {
            testChineseFilter();
        };
    </script>
</body>
</html>
