<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Emojiä¿®å¤éªŒè¯æµ‹è¯• - æ›´æ–°ç‰ˆ</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-result {
            background: #f0f8ff;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            border-left: 4px solid #007acc;
        }
        .error {
            background: #fff0f0;
            border-left-color: #ff4444;
        }
        .success {
            background: #f0fff0;
            border-left-color: #44ff44;
        }
        button {
            background: #007acc;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #005a9e;
        }
        .emoji-display {
            font-size: 24px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>ğŸš€ Emojiä¿®å¤éªŒè¯æµ‹è¯• - æ›´æ–°ç‰ˆ</h1>
    
    <div class="test-section">
        <h2>æµ‹è¯•1: å¿«é€Ÿæ¨¡å¼æ–‡æ¡ˆæ¨¡æ¿</h2>
        <p>æµ‹è¯•å¿«é€Ÿæ¨¡å¼ä¸‹æ—¥æœ¬æ–‡æ¡ˆæ¨¡æ¿çš„emojiæ˜¾ç¤ºï¼š</p>
        <button onclick="testJapaneseTemplates()">æµ‹è¯•æ—¥æœ¬æ–‡æ¡ˆæ¨¡æ¿</button>
        <div id="japanese-test-result"></div>
    </div>

    <div class="test-section">
        <h2>æµ‹è¯•2: cleanEmojiså‡½æ•°</h2>
        <p>æµ‹è¯•cleanEmojiså‡½æ•°æ˜¯å¦æ­£ç¡®ä¿ç•™å®‰å…¨çš„emojiï¼š</p>
        <button onclick="testCleanEmojis()">æµ‹è¯•cleanEmojiså‡½æ•°</button>
        <div id="clean-emoji-test-result"></div>
    </div>

    <div class="test-section">
        <h2>æµ‹è¯•3: å­—ç¬¦å®‰å…¨éªŒè¯</h2>
        <p>æµ‹è¯•æ–°çš„å­—ç¬¦å®‰å…¨éªŒè¯åŠŸèƒ½ï¼š</p>
        <button onclick="testCharacterSafety()">æµ‹è¯•å­—ç¬¦å®‰å…¨éªŒè¯</button>
        <div id="character-safety-result"></div>
    </div>

    <div class="test-section">
        <h2>æµ‹è¯•4: ç¬¦å·æ˜¾ç¤º</h2>
        <p>æµ‹è¯•å„ç§ç¬¦å·æ˜¯å¦æ­£ç¡®æ˜¾ç¤ºï¼š</p>
        <div class="emoji-display">
            âœ¨ ğŸ”¥ ğŸ’ª ğŸš€ ğŸ’ ğŸ”¥ â—† â—‡ â–  â–¡ â–² â–³ â–¶ â–· â— â—‹ â˜… â˜†
        </div>
        <div id="symbol-test-result"></div>
    </div>

    <script>
        // æ¨¡æ‹ŸcleanEmojiså‡½æ•°ï¼ˆä¿®å¤åçš„ç‰ˆæœ¬ï¼‰
        function cleanEmojis(text) {
            if (!text) return '';
            
            let cleanedText = text;
            
            // ç¬¬ä¸€è½®ï¼šç§»é™¤æ›¿æ¢å­—ç¬¦ï¼ˆçœŸæ­£çš„ä¹±ç ï¼‰
            cleanedText = cleanedText.replace(/[\uFFFD\uFFFE\uFFFF]/g, '');
            
            // ç¬¬äºŒè½®ï¼šç§»é™¤å­¤ç«‹çš„Unicodeä»£ç†å¯¹
            cleanedText = cleanedText.replace(/[\uD800-\uDFFF](?![\uDC00-\uDFFF])/g, '');
            cleanedText = cleanedText.replace(/(?<![\uD800-\uDBFF])[\uDC00-\uDFFF]/g, '');
            
            // ç¬¬ä¸‰è½®ï¼šç§»é™¤æ§åˆ¶å­—ç¬¦ï¼ˆé™¤äº†æ¢è¡Œç¬¦å’Œåˆ¶è¡¨ç¬¦ï¼‰
            cleanedText = cleanedText.replace(/[\u0000-\u0008\u000B\u000C\u000E-\u001F\u007F-\u009F]/g, '');
            
            // ç¬¬å››è½®ï¼šç§»é™¤é›¶å®½å­—ç¬¦
            cleanedText = cleanedText.replace(/[\u200B-\u200D\uFEFF]/g, '');
            
            // ç¬¬äº”è½®ï¼šç§»é™¤å¯èƒ½æœ‰é—®é¢˜çš„å‡ ä½•å›¾å½¢ç¬¦å·ï¼Œä½†ä¿ç•™å®‰å…¨çš„ç¬¦å·
            cleanedText = cleanedText.replace(/[\u25A0-\u25FF]/g, char => {
                const safeGeometricSymbols = ['â—†', 'â—‡', 'â– ', 'â–¡', 'â–²', 'â–³', 'â–¶', 'â–·', 'â—', 'â—‹', 'â˜…', 'â˜†'];
                return safeGeometricSymbols.includes(char) ? char : '';
            });
            
            // ç¬¬å…­è½®ï¼šç§»é™¤å¯èƒ½æœ‰é—®é¢˜çš„ç¬¦å·ï¼Œä½†ä¿ç•™å®‰å…¨çš„ç¬¦å·
            cleanedText = cleanedText.replace(/[\u2600-\u26FF]/g, char => {
                const safeSymbols = ['â­', 'ğŸŒŸ', 'ğŸ’«', 'âš¡', 'âšª', 'âš«'];
                return safeSymbols.includes(char) ? char : '';
            });
            
            // ç¬¬ä¸ƒè½®ï¼šæ™ºèƒ½emojiæ¸…ç† - åªä¿ç•™å®‰å…¨çš„emoji
            cleanedText = cleanedText.replace(/[\u{1F000}-\u{1FFFF}]/gu, char => {
                return isSafeEmoji(char) ? char : '';
            });
            
            // ç¬¬å…«è½®ï¼šæ¸…ç†å¤šä½™çš„ç©ºæ ¼ï¼ˆä¿ç•™æ¢è¡Œç¬¦ä»¥ç»´æŒæ–‡æ¡ˆç»“æ„ï¼‰
            cleanedText = cleanedText.replace(/[ \t]+/g, ' ').trim();
            
            return cleanedText;
        }

        // éªŒè¯emojiæ˜¯å¦å®‰å…¨çš„å‡½æ•°
        function isSafeEmoji(char) {
            const safeEmojiRanges = [
                [0x1F600, 0x1F64F], // è¡¨æƒ…ç¬¦å·
                [0x1F300, 0x1F5FF], // æ‚é¡¹ç¬¦å·å’Œè±¡å½¢æ–‡å­—
                [0x1F680, 0x1F6FF], // äº¤é€šå’Œåœ°å›¾ç¬¦å·
                [0x1F1E0, 0x1F1FF], // åŒºåŸŸæŒ‡ç¤ºç¬¦å·
                [0x2600, 0x26FF],   // æ‚é¡¹ç¬¦å·
                [0x2700, 0x27BF],   // è£…é¥°ç¬¦å·
                [0xFE00, 0xFE0F],   // å˜ä½“é€‰æ‹©å™¨
                [0x1F900, 0x1F9FF], // è¡¥å……ç¬¦å·å’Œè±¡å½¢æ–‡å­—
                [0x1F018, 0x1F270], // å°é—­å­—æ¯æ•°å­—è¡¥å……
                [0x2B00, 0x2BFF],   // æ‚é¡¹ç¬¦å·å’Œç®­å¤´ (åŒ…å«â­ U+2B50)
                [0x2300, 0x23FF],   // æŠ€æœ¯ç¬¦å·
                [0x2000, 0x206F],   // é€šç”¨æ ‡ç‚¹
                [0x2100, 0x214F],   // å­—æ¯ç±»ç¬¦å·
                [0x2190, 0x21FF],   // ç®­å¤´
                [0x2200, 0x22FF],   // æ•°å­¦è¿ç®—ç¬¦
                [0x25A0, 0x25FF],   // å‡ ä½•å›¾å½¢
            ];
            
            const codePoint = char.codePointAt(0);
            if (!codePoint) return false;
            
            return safeEmojiRanges.some(([start, end]) => codePoint >= start && codePoint <= end);
        }

        // ğŸ”¥ æ–°å¢ï¼šç¡®ä¿æ‰€æœ‰å­—ç¬¦éƒ½èƒ½æ­£å¸¸æ˜¾ç¤ºçš„å‡½æ•°
        function ensureDisplayableCharacters(text) {
            if (!text) return '';
            
            let safeText = '';
            
            for (let i = 0; i < text.length; i++) {
                const char = text[i];
                
                // æ£€æŸ¥å­—ç¬¦æ˜¯å¦å®‰å…¨
                if (isCharSafe(char)) {
                    safeText += char;
                } else {
                    // å¦‚æœå­—ç¬¦ä¸å®‰å…¨ï¼Œå°è¯•æ‰¾åˆ°å®‰å…¨çš„æ›¿ä»£å“
                    const replacement = getSafeReplacement(char);
                    safeText += replacement;
                    console.log(`âš ï¸ æ›¿æ¢ä¸å®‰å…¨çš„å­—ç¬¦: "${char}" -> "${replacement}"`);
                }
            }
            
            return safeText;
        }

        // æ£€æŸ¥å•ä¸ªå­—ç¬¦æ˜¯å¦å®‰å…¨
        function isCharSafe(char) {
            // åŸºæœ¬ASCIIå­—ç¬¦ï¼ˆè‹±æ–‡ã€æ•°å­—ã€æ ‡ç‚¹ï¼‰
            if (char.charCodeAt(0) < 128) return true;
            
            // å®‰å…¨çš„emoji
            if (isSafeEmoji(char)) return true;
            
            // å®‰å…¨çš„å‡ ä½•ç¬¦å·
            const safeGeometricSymbols = ['â—†', 'â—‡', 'â– ', 'â–¡', 'â–²', 'â–³', 'â–¶', 'â–·', 'â—', 'â—‹', 'â˜…', 'â˜†'];
            if (safeGeometricSymbols.includes(char)) return true;
            
            // å®‰å…¨çš„å…¶ä»–ç¬¦å·
            const safeOtherSymbols = ['â­', 'ğŸŒŸ', 'ğŸ’«', 'âš¡', 'âšª', 'âš«'];
            if (safeOtherSymbols.includes(char)) return true;
            
            // æ—¥æ–‡å­—ç¬¦èŒƒå›´
            const japaneseRanges = [
                [0x3040, 0x309F], // å¹³å‡å
                [0x30A0, 0x30FF], // ç‰‡å‡å
                [0x4E00, 0x9FFF], // æ±‰å­—
                [0xFF00, 0xFFEF], // å…¨è§’å­—ç¬¦
            ];
            
            const codePoint = char.codePointAt(0);
            if (codePoint) {
                for (const [start, end] of japaneseRanges) {
                    if (codePoint >= start && codePoint <= end) return true;
                }
            }
            
            // éŸ©æ–‡å­—ç¬¦èŒƒå›´
            const koreanRanges = [
                [0xAC00, 0xD7AF], // è°šæ–‡
            ];
            
            if (codePoint) {
                for (const [start, end] of koreanRanges) {
                    if (codePoint >= start && codePoint <= end) return true;
                }
            }
            
            return false;
        }

        // è·å–å®‰å…¨çš„å­—ç¬¦æ›¿ä»£å“
        function getSafeReplacement(char) {
            // å®šä¹‰å­—ç¬¦æ›¿æ¢æ˜ å°„
            const replacements = {
                'â­': 'ğŸ”¥',  // æ˜Ÿå½¢ç¬¦å· -> ç«ç„°
                'ğŸŒŸ': 'âœ¨',  // æ˜Ÿå½¢ç¬¦å· -> é—ªçƒ
                'ğŸ’«': 'âœ¨',  // æ˜Ÿå½¢ç¬¦å· -> é—ªçƒ
                'âš¡': 'ğŸ”¥',  // é—ªç”µ -> ç«ç„°
                'âšª': 'â—',   // ç™½è‰²åœ†åœˆ -> é»‘è‰²åœ†åœˆ
                'âš«': 'â—',   // é»‘è‰²åœ†åœˆ -> é»‘è‰²åœ†åœˆ
                'â—†': 'âœ¨',  // é»‘è‰²è±å½¢ -> é—ªçƒ
                'â—‡': 'âœ¨',  // ç™½è‰²è±å½¢ -> é—ªçƒ
                'â– ': 'â—',   // é»‘è‰²æ–¹å— -> é»‘è‰²åœ†åœˆ
                'â–¡': 'â—',   // ç™½è‰²æ–¹å— -> é»‘è‰²åœ†åœˆ
                'â–²': 'â–²',   // é»‘è‰²ä¸‰è§’å½¢ -> ä¿ç•™
                'â–³': 'â–³',   // ç™½è‰²ä¸‰è§’å½¢ -> ä¿ç•™
                'â–¶': 'â–¶',   // é»‘è‰²å³ä¸‰è§’ -> ä¿ç•™
                'â–·': 'â–·',   // ç™½è‰²å³ä¸‰è§’ -> ä¿ç•™
                '': 'âœ¨',   // æ›¿æ¢å­—ç¬¦ -> é—ªçƒ
            };
            
            return replacements[char] || 'âœ¨'; // é»˜è®¤æ›¿æ¢ä¸ºé—ªçƒç¬¦å·
        }

        // æµ‹è¯•æ—¥æœ¬æ–‡æ¡ˆæ¨¡æ¿
        function testJapaneseTemplates() {
            const templates = [
                'âœ¨ æ•°ç é…ä»¶ã§äººç”Ÿã‚’å¤‰ãˆã‚ˆã†ï¼é«˜å“è´¨ å…¼å®¹æ€§å¼º æ—¶å°šè®¾è®¡ å®ç”¨åŠŸèƒ½ã€æ•°ç çˆ±å¥½è€… 3C ç”¨æˆ·ã®ãŸã‚ã«è¨­è¨ˆã•ã‚Œã¾ã—ãŸã€‚ãƒ†ã‚¯ãƒãƒ­ã‚¸ãƒ¼ã¨ãƒ©ã‚¤ãƒ•ã‚¹ã‚¿ã‚¤ãƒ«ã®å®Œç’§ãªèåˆã‚’ä½“é¨“ã—ã‚ˆã†ï¼',
                'ğŸ”¥ æ•°ç é…ä»¶ã®ç‹¬ç‰¹ãªé­…åŠ›ã‚’ç™ºè¦‹ï¼é«˜å“è´¨ å…¼å®¹æ€§å¼º æ—¶å°šè®¾è®¡ å®ç”¨åŠŸèƒ½ã§æ•°ç çˆ±å¥½è€… 3C ç”¨æˆ·ã®ä¸­ã§éš›ç«‹ã¨ã†ã€‚æœŸé–“é™å®šã‚ªãƒ•ã‚¡ãƒ¼ã€ãŠè¦‹é€ƒã—ãªãï¼',
                'ğŸ’ª äººæ°—å•†å“ï¼æ•°ç é…ä»¶ã¯é«˜å“è´¨ å…¼å®¹æ€§å¼º æ—¶å°šè®¾è®¡ å®ç”¨åŠŸèƒ½ã§æ•°ç çˆ±å¥½è€… 3C ç”¨æˆ·ã®ç¬¬ä¸€é¸æŠè‚¢ã«ã€‚ä»Šã™ãç‰¹åˆ¥å‰²å¼•ã‚’ã‚²ãƒƒãƒˆï¼'
            ];

            const resultDiv = document.getElementById('japanese-test-result');
            let html = '<h3>æµ‹è¯•ç»“æœï¼š</h3>';

            templates.forEach((template, index) => {
                const cleaned = cleanEmojis(template);
                const hasReplacementChar = cleaned.includes('');
                const status = hasReplacementChar ? 'âŒ å¤±è´¥' : 'âœ… æˆåŠŸ';
                const statusClass = hasReplacementChar ? 'error' : 'success';

                html += `
                    <div class="test-result ${statusClass}">
                        <strong>æ–‡æ¡ˆ ${index + 1}:</strong> ${status}<br>
                        <strong>åŸå§‹æ–‡æ¡ˆ:</strong> ${template}<br>
                        <strong>æ¸…ç†åæ–‡æ¡ˆ:</strong> ${cleaned}<br>
                        <strong>åŒ…å«æ›¿æ¢å­—ç¬¦:</strong> ${hasReplacementChar ? 'æ˜¯' : 'å¦'}
                    </div>
                `;
            });

            resultDiv.innerHTML = html;
        }

        // æµ‹è¯•cleanEmojiså‡½æ•°
        function testCleanEmojis() {
            const testCases = [
                'âœ¨ æ­£å¸¸emoji',
                'ğŸ”¥ ç«ç„°emoji',
                'ğŸ’ª è‚Œè‚‰emoji',
                'â—† é»‘è‰²è±å½¢',
                'â—‡ ç™½è‰²è±å½¢',
                'â–  é»‘è‰²æ–¹å—',
                'â–¡ ç™½è‰²æ–¹å—',
                'â–² é»‘è‰²ä¸‰è§’å½¢',
                'â–³ ç™½è‰²ä¸‰è§’å½¢',
                'â–¶ é»‘è‰²å³ä¸‰è§’',
                'â–· ç™½è‰²å³ä¸‰è§’',
                'â— é»‘è‰²åœ†å½¢',
                'â—‹ ç™½è‰²åœ†å½¢',
                'â˜… é»‘è‰²æ˜Ÿå½¢',
                'â˜† ç™½è‰²æ˜Ÿå½¢'
            ];

            const resultDiv = document.getElementById('clean-emoji-test-result');
            let html = '<h3>æµ‹è¯•ç»“æœï¼š</h3>';

            testCases.forEach(testCase => {
                const cleaned = cleanEmojis(testCase);
                const hasReplacementChar = cleaned.includes('');
                const status = hasReplacementChar ? 'âŒ å¤±è´¥' : 'âœ… æˆåŠŸ';
                const statusClass = hasReplacementChar ? 'error' : 'success';

                html += `
                    <div class="test-result ${statusClass}">
                        <strong>æµ‹è¯•ç”¨ä¾‹:</strong> ${testCase}<br>
                        <strong>æ¸…ç†ç»“æœ:</strong> ${cleaned}<br>
                        <strong>çŠ¶æ€:</strong> ${status}
                    </div>
                `;
            });

            resultDiv.innerHTML = html;
        }

        // æµ‹è¯•å­—ç¬¦å®‰å…¨éªŒè¯
        function testCharacterSafety() {
            const testCases = [
                'âœ¨ æ­£å¸¸emoji',
                'ğŸ”¥ ç«ç„°emoji',
                'ğŸ’ª è‚Œè‚‰emoji',
                'â—† é»‘è‰²è±å½¢',
                'â—‡ ç™½è‰²è±å½¢',
                'â–  é»‘è‰²æ–¹å—',
                'â–¡ ç™½è‰²æ–¹å—',
                'â–² é»‘è‰²ä¸‰è§’å½¢',
                'â–³ ç™½è‰²ä¸‰è§’å½¢',
                'â–¶ é»‘è‰²å³ä¸‰è§’',
                'â–· ç™½è‰²å³ä¸‰è§’',
                'â— é»‘è‰²åœ†å½¢',
                'â—‹ ç™½è‰²åœ†å½¢',
                'â˜… é»‘è‰²æ˜Ÿå½¢',
                'â˜† ç™½è‰²æ˜Ÿå½¢',
                'â­ æ˜Ÿå½¢ç¬¦å·ï¼ˆå°†è¢«æ›¿æ¢ï¼‰',
                'ğŸŒŸ æ˜Ÿå½¢ç¬¦å·ï¼ˆå°†è¢«æ›¿æ¢ï¼‰',
                'ğŸ’« æ˜Ÿå½¢ç¬¦å·ï¼ˆå°†è¢«æ›¿æ¢ï¼‰',
                'âš¡ é—ªç”µç¬¦å·ï¼ˆå°†è¢«æ›¿æ¢ï¼‰',
                'âšª ç™½è‰²åœ†åœˆï¼ˆå°†è¢«æ›¿æ¢ï¼‰',
                'âš« é»‘è‰²åœ†åœˆï¼ˆå°†è¢«æ›¿æ¢ï¼‰'
            ];

            const resultDiv = document.getElementById('character-safety-result');
            let html = '<h3>å­—ç¬¦å®‰å…¨éªŒè¯æµ‹è¯•ç»“æœï¼š</h3>';

            testCases.forEach(testCase => {
                const step1 = cleanEmojis(testCase);
                const step2 = ensureDisplayableCharacters(step1);
                const hasReplacementChar = step2.includes('');
                const status = hasReplacementChar ? 'âŒ å¤±è´¥' : 'âœ… æˆåŠŸ';
                const statusClass = hasReplacementChar ? 'error' : 'success';

                html += `
                    <div class="test-result ${statusClass}">
                        <strong>æµ‹è¯•ç”¨ä¾‹:</strong> ${testCase}<br>
                        <strong>æ­¥éª¤1 - cleanEmojis:</strong> ${step1}<br>
                        <strong>æ­¥éª¤2 - å­—ç¬¦å®‰å…¨éªŒè¯:</strong> ${step2}<br>
                        <strong>çŠ¶æ€:</strong> ${status}
                    </div>
                `;
            });

            resultDiv.innerHTML = html;
        }

        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨è¿è¡Œæµ‹è¯•
        window.onload = function() {
            console.log('ğŸš€ å¼€å§‹emojiä¿®å¤éªŒè¯æµ‹è¯•...');
            testJapaneseTemplates();
            testCleanEmojis();
            testCharacterSafety();
        };
    </script>
</body>
</html>
