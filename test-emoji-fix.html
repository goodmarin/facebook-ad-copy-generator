<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Emojiä¿®å¤å’Œç©ºæ ¼æ¸…ç†æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .test-container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin: 20px 0;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
        }
        .test-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            margin: 10px 0;
        }
        .test-button {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
            transition: transform 0.2s;
        }
        .test-button:hover {
            transform: translateY(-2px);
        }
        .result {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            border-left: 4px solid #667eea;
        }
        .emoji-test {
            font-size: 24px;
            margin: 10px 0;
        }
        .space-test {
            font-family: monospace;
            background: #f0f0f0;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .status {
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
            margin: 5px;
            display: inline-block;
        }
        .status.success { background: #d4edda; color: #155724; }
        .status.warning { background: #fff3cd; color: #856404; }
        .status.error { background: #f8d7da; color: #721c24; }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸš€ Emojiä¿®å¤å’Œç©ºæ ¼æ¸…ç†æµ‹è¯•</h1>
        
        <div class="test-section">
            <h2>ğŸ“ æ–‡æ¡ˆè¾“å…¥æµ‹è¯•</h2>
            <textarea 
                id="testInput" 
                class="test-input" 
                rows="6" 
                placeholder="è¯·è¾“å…¥åŒ…å«emojiå’Œå¼‚å¸¸ç©ºæ ¼çš„æ–‡æ¡ˆè¿›è¡Œæµ‹è¯•..."
            >ğŸš€ å‘ç°  æ™ºèƒ½æ— çº¿è€³æœº  -  ä¸»åŠ¨é™å™ª,  é•¿ç»­èˆª,  å¿«é€Ÿå……ç”µ  é€‚åˆ  å¹´è½»ä¸Šç­æ—  ğŸ§  é™æ—¶ä¼˜æƒ ï¼</textarea>
            
            <div>
                <button class="test-button" onclick="testSpaceCleaning()">ğŸ§¹ æµ‹è¯•ç©ºæ ¼æ¸…ç†</button>
                <button class="test-button" onclick="testEmojiCleaning()">âœ¨ æµ‹è¯•Emojiæ¸…ç†</button>
                <button class="test-button" onclick="testFullCleaning()">ğŸ”„ æµ‹è¯•å®Œæ•´æ¸…ç†</button>
            </div>
            
            <div id="spaceResult" class="result" style="display: none;"></div>
            <div id="emojiResult" class="result" style="display: none;"></div>
            <div id="fullResult" class="result" style="display: none;"></div>
        </div>

        <div class="test-section">
            <h2>ğŸ” Emojiå…¼å®¹æ€§æµ‹è¯•</h2>
            <div class="emoji-test">
                <p>æ ‡å‡†Emoji: ğŸ˜Š ğŸ˜ ğŸ¤© ğŸ˜œ ğŸ¥³ ğŸ˜­ ğŸ˜ ğŸ¤” ğŸ˜¤ ğŸ’ª ğŸ˜… ğŸ¤— ğŸ˜‹ ğŸ˜´ ğŸ¤¯</p>
                <p>ç¬¦å·Emoji: âœ¨ ğŸ’ ğŸ¨ ğŸŒˆ ğŸµ ğŸ§ ğŸ¬ ğŸ­ ğŸª ğŸŸï¸ ğŸ ğŸ† ğŸ’¸ ğŸ”¥ ğŸŒŸ</p>
                <p>äº¤é€šEmoji: ğŸš€ ğŸ’» ğŸ“± ğŸ“¦ ğŸ› ï¸ âš¡ï¸ ğŸ”§ ğŸ“Š ğŸ¯ ğŸ’¡ ğŸ” ğŸ“ˆ ğŸŠ ğŸ‰ ğŸ’¥</p>
            </div>
            
            <button class="test-button" onclick="testEmojiCompatibility()">ğŸ” æµ‹è¯•Emojiå…¼å®¹æ€§</button>
            <div id="compatibilityResult" class="result" style="display: none;"></div>
        </div>

        <div class="test-section">
            <h2>ğŸ“Š æ–‡æ¡ˆè´¨é‡åˆ†æ</h2>
            <div id="qualityAnalysis" class="result">
                <p>ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®å¼€å§‹åˆ†ææ–‡æ¡ˆè´¨é‡...</p>
            </div>
            
            <button class="test-button" onclick="analyzeCopyQuality()">ğŸ“Š åˆ†ææ–‡æ¡ˆè´¨é‡</button>
        </div>

        <div class="test-section">
            <h2>ğŸ”„ é‡è¯•æœºåˆ¶æµ‹è¯•</h2>
            <div id="retryTest" class="result">
                <p>æ¨¡æ‹Ÿæ–‡æ¡ˆç”Ÿæˆé‡è¯•æœºåˆ¶...</p>
            </div>
            
            <button class="test-button" onclick="testRetryMechanism()">ğŸ”„ æµ‹è¯•é‡è¯•æœºåˆ¶</button>
        </div>
    </div>

    <script>
        // æ¨¡æ‹Ÿemojiæ¸…ç†å‡½æ•°
        function cleanEmojis(text) {
            console.log('ğŸ” cleanEmojis è¾“å…¥:', text);
            
            // ç§»é™¤æ‰€æœ‰å·²çŸ¥çš„emojiå’Œç¬¦å·
            const symbolsToRemove = [
                'â“', 'â”', 'â•', 'â–', 'ğŸ”¥', 'ğŸ’¥', 'ğŸ’¢', 'ğŸ’£', 'ğŸ’¤', 'â™ª', 'â™«', 'â™¬', 'â™©', 'ğŸ’', 'â³', 'â†’',
                'âœ¨', 'â­', 'ğŸ’¡', 'ğŸ¯', 'ğŸš€', 'ğŸ’ª', 'ğŸ§', 'ğŸµ', 'ğŸ¶', 'ğŸ¤', 'ğŸ¼', 'ğŸ¹', 'ğŸ¥', 'ğŸ·', 'ğŸº', 'ğŸ¸', 'ğŸ»'
            ];
            
            let cleanedText = text;
            symbolsToRemove.forEach(symbol => {
                cleanedText = cleanedText.replace(new RegExp(symbol, 'g'), '');
            });
            
            console.log('ğŸ” cleanEmojis è¾“å‡º:', cleanedText);
            return cleanedText;
        }

        // æ¨¡æ‹Ÿç©ºæ ¼æ¸…ç†å‡½æ•°
        function cleanSpaces(text) {
            console.log('ğŸ§¹ cleanSpaces è¾“å…¥:', text);
            
            // æ¸…ç†å•è¯ä¸­é—´çš„å¤šä½™ç©ºæ ¼ï¼Œä¿æŒæ­£å¸¸çš„å•è¯é—´è·
            let cleanedText = text
                .replace(/\s+/g, ' ')  // å°†å¤šä¸ªè¿ç»­ç©ºæ ¼æ›¿æ¢ä¸ºå•ä¸ªç©ºæ ¼
                .replace(/(\w)\s+(\w)/g, '$1 $2')  // ç¡®ä¿å•è¯é—´åªæœ‰ä¸€ä¸ªç©ºæ ¼
                .trim();  // ç§»é™¤å¼€å¤´å’Œç»“å°¾çš„ç©ºæ ¼
            
            console.log('ğŸ§¹ cleanSpaces è¾“å‡º:', cleanedText);
            return cleanedText;
        }

        // æµ‹è¯•ç©ºæ ¼æ¸…ç†
        function testSpaceCleaning() {
            const input = document.getElementById('testInput').value;
            const result = cleanSpaces(input);
            
            const resultDiv = document.getElementById('spaceResult');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = `
                <h3>ğŸ§¹ ç©ºæ ¼æ¸…ç†ç»“æœ</h3>
                <div class="space-test">
                    <strong>åŸå§‹æ–‡æ¡ˆ:</strong> "${input}"
                </div>
                <div class="space-test">
                    <strong>æ¸…ç†å:</strong> "${result}"
                </div>
                <div class="status success">âœ… ç©ºæ ¼æ¸…ç†å®Œæˆ</div>
            `;
        }

        // æµ‹è¯•Emojiæ¸…ç†
        function testEmojiCleaning() {
            const input = document.getElementById('testInput').value;
            const result = cleanEmojis(input);
            
            const resultDiv = document.getElementById('emojiResult');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = `
                <h3>âœ¨ Emojiæ¸…ç†ç»“æœ</h3>
                <div class="space-test">
                    <strong>åŸå§‹æ–‡æ¡ˆ:</strong> "${input}"
                </div>
                <div class="space-test">
                    <strong>æ¸…ç†å:</strong> "${result}"
                </div>
                <div class="status success">âœ… Emojiæ¸…ç†å®Œæˆ</div>
            `;
        }

        // æµ‹è¯•å®Œæ•´æ¸…ç†
        function testFullCleaning() {
            const input = document.getElementById('testInput').value;
            const emojiCleaned = cleanEmojis(input);
            const fullyCleaned = cleanSpaces(emojiCleaned);
            
            const resultDiv = document.getElementById('fullResult');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = `
                <h3>ğŸ”„ å®Œæ•´æ¸…ç†ç»“æœ</h3>
                <div class="space-test">
                    <strong>åŸå§‹æ–‡æ¡ˆ:</strong> "${input}"
                </div>
                <div class="space-test">
                    <strong>Emojiæ¸…ç†å:</strong> "${emojiCleaned}"
                </div>
                <div class="space-test">
                    <strong>æœ€ç»ˆç»“æœ:</strong> "${fullyCleaned}"
                </div>
                <div class="status success">âœ… å®Œæ•´æ¸…ç†å®Œæˆ</div>
            `;
        }

        // æµ‹è¯•Emojiå…¼å®¹æ€§
        function testEmojiCompatibility() {
            const testEmojis = ['ğŸ˜Š', 'ğŸ˜', 'ğŸ¤©', 'ğŸ˜œ', 'ğŸ¥³', 'ğŸ˜­', 'ğŸ˜', 'ğŸ¤”', 'ğŸ˜¤', 'ğŸ’ª', 'ğŸ˜…', 'ğŸ¤—', 'ğŸ˜‹', 'ğŸ˜´', 'ğŸ¤¯'];
            const resultDiv = document.getElementById('compatibilityResult');
            
            let compatibilityResults = '';
            testEmojis.forEach(emoji => {
                try {
                    const codePoint = emoji.codePointAt(0);
                    const isBMP = codePoint <= 0xFFFF;
                    const status = isBMP ? 'success' : 'warning';
                    const text = isBMP ? 'BMPå…¼å®¹' : 'SMPå…¼å®¹';
                    
                    compatibilityResults += `<span class="status ${status}">${emoji} ${text}</span>`;
                } catch (error) {
                    compatibilityResults += `<span class="status error">${emoji} é”™è¯¯</span>`;
                }
            });
            
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = `
                <h3>ğŸ” Emojiå…¼å®¹æ€§æµ‹è¯•ç»“æœ</h3>
                <p>æµ‹è¯•äº† ${testEmojis.length} ä¸ªemojiçš„å…¼å®¹æ€§ï¼š</p>
                <div>${compatibilityResults}</div>
                <p><strong>è¯´æ˜:</strong></p>
                <ul>
                    <li><span class="status success">BMPå…¼å®¹</span> - åŸºæœ¬å¤šæ–‡ç§å¹³é¢ï¼Œå…¼å®¹æ€§æœ€å¥½</li>
                    <li><span class="status warning">SMPå…¼å®¹</span> - è¡¥å……å¤šæ–‡ç§å¹³é¢ï¼Œå…¼å®¹æ€§ä¸­ç­‰</li>
                    <li><span class="status error">é”™è¯¯</span> - æ— æ³•è¯†åˆ«çš„emoji</li>
                </ul>
            `;
        }

        // åˆ†ææ–‡æ¡ˆè´¨é‡
        function analyzeCopyQuality() {
            const input = document.getElementById('testInput').value;
            const analysisDiv = document.getElementById('qualityAnalysis');
            
            // åˆ†ææ–‡æ¡ˆé•¿åº¦
            const length = input.length;
            const wordCount = input.trim().split(/\s+/).length;
            const emojiCount = (input.match(/[\u{1F600}-\u{1F64F}\u{1F300}-\u{1F5FF}\u{1F680}-\u{1F6FF}\u{1F1E0}-\u{1F1FF}\u{2600}-\u{26FF}\u{2700}-\u{27BF}\u{FE00}-\u{FE0F}\u{1F900}-\u{1F9FF}\u{1FA70}-\u{1FAFF}\u{1FAB0}-\u{1FABF}\u{1FAC0}-\u{1FAFF}\u{1FAD0}-\u{1FAFF}\u{1FAE0}-\u{1FAFF}\u{1FAF0}-\u{1FAFF}]/gu) || []).length;
            
            // åˆ†æç©ºæ ¼é—®é¢˜
            const extraSpaces = (input.match(/\s{2,}/g) || []).length;
            const spaceStatus = extraSpaces > 0 ? 'warning' : 'success';
            
            // åˆ†æemojié—®é¢˜
            const emojiStatus = emojiCount > 0 ? 'success' : 'warning';
            
            analysisDiv.innerHTML = `
                <h3>ğŸ“Š æ–‡æ¡ˆè´¨é‡åˆ†æç»“æœ</h3>
                <div class="space-test">
                    <strong>æ–‡æ¡ˆé•¿åº¦:</strong> ${length} å­—ç¬¦
                    <span class="status ${length >= 50 && length <= 200 ? 'success' : 'warning'}">
                        ${length >= 50 && length <= 200 ? 'âœ… é•¿åº¦åˆé€‚' : 'âš ï¸ é•¿åº¦éœ€è°ƒæ•´'}
                    </span>
                </div>
                <div class="space-test">
                    <strong>å•è¯æ•°é‡:</strong> ${wordCount} ä¸ª
                </div>
                <div class="space-test">
                    <strong>Emojiæ•°é‡:</strong> ${emojiCount} ä¸ª
                    <span class="status ${emojiStatus}">
                        ${emojiCount > 0 ? 'âœ… åŒ…å«Emoji' : 'âš ï¸ ç¼ºå°‘Emoji'}
                    </span>
                </div>
                <div class="space-test">
                    <strong>ç©ºæ ¼é—®é¢˜:</strong> å‘ç° ${extraSpaces} å¤„å¤šä½™ç©ºæ ¼
                    <span class="status ${spaceStatus}">
                        ${extraSpaces > 0 ? 'âš ï¸ éœ€è¦æ¸…ç†' : 'âœ… ç©ºæ ¼æ­£å¸¸'}
                    </span>
                </div>
                <div class="space-test">
                    <strong>æ€»ä½“è¯„åˆ†:</strong> 
                    <span class="status ${(length >= 50 && length <= 200 && emojiCount > 0 && extraSpaces === 0) ? 'success' : 'warning'}">
                        ${(length >= 50 && length <= 200 && emojiCount > 0 && extraSpaces === 0) ? 'ä¼˜ç§€' : 'éœ€æ”¹è¿›'}
                    </span>
                </div>
            `;
        }

        // æµ‹è¯•é‡è¯•æœºåˆ¶
        function testRetryMechanism() {
            const retryDiv = document.getElementById('retryTest');
            let attempts = 0;
            const maxRetries = 2;
            
            retryDiv.innerHTML = `
                <h3>ğŸ”„ é‡è¯•æœºåˆ¶æµ‹è¯•</h3>
                <p>æ¨¡æ‹Ÿæ–‡æ¡ˆç”Ÿæˆé‡è¯•è¿‡ç¨‹...</p>
                <div id="retryProgress"></div>
            `;
            
            const progressDiv = document.getElementById('retryProgress');
            
            function simulateRetry() {
                attempts++;
                progressDiv.innerHTML += `
                    <div class="space-test">
                        <strong>ç¬¬ ${attempts} æ¬¡å°è¯•:</strong> 
                        ${attempts <= maxRetries ? 'ğŸ”„ ç”Ÿæˆä¸­...' : 'âŒ è¾¾åˆ°æœ€å¤§é‡è¯•æ¬¡æ•°'}
                    </div>
                `;
                
                if (attempts <= maxRetries) {
                    setTimeout(() => {
                        if (attempts === 1) {
                            progressDiv.innerHTML += `
                                <div class="status warning">âš ï¸ ç¬¬1æ¬¡ç”Ÿæˆå¤±è´¥ï¼Œemojiè´¨é‡é—®é¢˜ï¼Œå‡†å¤‡é‡è¯•...</div>
                            `;
                            setTimeout(simulateRetry, 1000);
                        } else if (attempts === 2) {
                            progressDiv.innerHTML += `
                                <div class="status warning">âš ï¸ ç¬¬2æ¬¡ç”Ÿæˆå¤±è´¥ï¼Œemojiè´¨é‡é—®é¢˜ï¼Œå‡†å¤‡é‡è¯•...</div>
                            `;
                            setTimeout(simulateRetry, 1000);
                        } else {
                            progressDiv.innerHTML += `
                                <div class="status error">âŒ æ‰€æœ‰é‡è¯•éƒ½å¤±è´¥ï¼Œä½¿ç”¨emojiè¿‡æ»¤åçš„æ–‡æ¡ˆ</div>
                                <div class="status success">âœ… æœ€ç»ˆæ–‡æ¡ˆå·²ç”Ÿæˆï¼Œemojiå·²è¿‡æ»¤</div>
                            `;
                        }
                    }, 1000);
                }
            }
            
            simulateRetry();
        }

        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨åˆ†æ
        window.addEventListener('load', () => {
            analyzeCopyQuality();
        });
    </script>
</body>
</html>
