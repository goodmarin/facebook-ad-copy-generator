<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>主应用场景测试</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 1000px; margin: 0 auto; padding: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        button { background: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin: 5px; }
        .result { margin-top: 10px; padding: 10px; background: #f8f9fa; border-radius: 5px; white-space: pre-wrap; font-family: monospace; }
        .error { background: #f8d7da; color: #721c24; }
        .success { background: #d4edda; color: #155724; }
    </style>
</head>
<body>
    <h1>主应用场景测试</h1>
    
    <div class="test-section">
        <h3>1. 效果预测API测试（模拟主应用）</h3>
        <button onclick="testEffectPrediction()">测试效果预测</button>
        <div id="effect-result" class="result"></div>
    </div>
    
    <div class="test-section">
        <h3>2. 文案生成API测试（模拟主应用）</h3>
        <button onclick="testCopyGeneration()">测试文案生成</button>
        <div id="copy-result" class="result"></div>
    </div>

    <script>
        const apiKey = 'sk-674b29e0b86846bca55195b66eb3e3aa';
        
        async function testEffectPrediction() {
            const result = document.getElementById('effect-result');
            result.textContent = '测试中...';
            result.className = 'result';
            
            try {
                const testCopy = '✨ Elevate your sound game! Crystal-clear audio, Active Noise Cancellation, and all-day comfort. ⭐ Fast charging means more music, less waiting. 🎧 Limited-time discount—upgrade your vibe today!';
                
                const prompt = `请对以下 Facebook 广告文案进行营销效果预测，输出格式如下：
- 预估点击率（CTR）百分比（例如 3.2%）
- 效果评分（1~5星）
- 简短优化建议

文案内容：『${testCopy}』

请严格按照以下格式返回，不要添加其他内容：
CTR: [百分比]
评分: [星级]
建议: [一句话建议]`;

                const requestBody = {
                    model: 'deepseek-chat',
                    messages: [
                        {
                            role: 'system',
                            content: '你是一个专业的Facebook广告效果预测专家，能够准确评估广告文案的营销效果。'
                        },
                        {
                            role: 'user',
                            content: prompt
                        }
                    ],
                    max_tokens: 150,
                    temperature: 0.1,
                    top_p: 0.8
                };

                const response = await fetch('https://api.deepseek.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${apiKey}`
                    },
                    body: JSON.stringify(requestBody)
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(`API错误: ${response.status} - ${JSON.stringify(errorData)}`);
                }

                const data = await response.json();
                const content = data.choices[0]?.message?.content;
                
                if (!content) {
                    throw new Error('效果预测AI未返回有效内容');
                }

                result.textContent = `效果预测测试成功!\n\nAI返回内容:\n${content}`;
                result.className = 'result success';
                
            } catch (error) {
                result.textContent = `效果预测测试失败: ${error.message}`;
                result.className = 'result error';
                console.error('效果预测测试错误:', error);
            }
        }
        
        async function testCopyGeneration() {
            const result = document.getElementById('copy-result');
            result.textContent = '测试中...';
            result.className = 'result';
            
            try {
                const prompt = `Create 3 engaging Facebook ad copies in English for:
Product: Wireless Headphones
Features: Crystal-clear audio, Active Noise Cancellation, all-day comfort
Audience: Music lovers and professionals
Style: Modern and premium
Promotion: Limited-time discount

Requirements:
- 100% English, no Chinese characters
- 120-180 characters each
- Include relevant emojis naturally throughout the copy
- Use emotional triggers and compelling call-to-action
- Format: Copy 1: [content] | Copy 2: [content] | Copy 3: [content]`;

                const requestBody = {
                    model: 'deepseek-chat',
                    messages: [
                        {
                            role: 'system',
                            content: 'You are a creative English Facebook ad copywriter specializing in engaging, conversion-focused content. Generate 100% English content only, no Chinese characters. Use relevant emojis naturally, create emotional connections and include compelling calls-to-action.'
                        },
                        {
                            role: 'user',
                            content: prompt
                        }
                    ],
                    max_tokens: 600,
                    temperature: 0.7,
                    top_p: 0.8
                };

                const response = await fetch('https://api.deepseek.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${apiKey}`
                    },
                    body: JSON.stringify(requestBody)
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(`API错误: ${response.status} - ${JSON.stringify(errorData)}`);
                }

                const data = await response.json();
                const content = data.choices[0]?.message?.content;
                
                if (!content) {
                    throw new Error('文案生成AI未返回有效内容');
                }

                const processedContent = cleanEmojis(content);
                
                result.textContent = `文案生成测试成功!\n\n原始内容:\n${content}\n\n处理后内容:\n${processedContent}`;
                result.className = 'result success';
                
            } catch (error) {
                result.textContent = `文案生成测试失败: ${error.message}`;
                result.className = 'result error';
                console.error('文案生成测试错误:', error);
            }
        }
        
        function cleanEmojis(text) {
            console.log('cleanEmojis 输入:', text);
            
            let cleanedText = text;
            
            // 直接移除所有已知的问题emoji和符号
            const symbolsToRemove = [
                '❓', '❔', '❕', '❖', '🔥', '💥', '💢', '💣', '💤', '♪', '♫', '♬', '♩', '💎', '⏳', '→',
                '✨', '⭐', '💡', '🎯', '🚀', '💪', '🎧', '🎵', '🎶', '🎤', '🎼', '🎹', '🥁', '🎷', '🎺', '🎸', '🎻',
                '🎮', '🎲', '🧩', '🎳', '🎪', '🎭', '🎨', '🎬', '⚙️', '🎭', '🎪', '🎨', '🎬', '🎤', '🎧', '🎼', '🎹',
                '🥁', '🎷', '🎺', '🎸', '🎻', '🎮', '🎲', '🧩', '🎯', '🎳', '🎪', '🎭', '🎨', '🎬', '🎤', '🎧', '🎼',
                '🎹', '🥁', '🎷', '🎺', '🎸', '🎻', '🎮', '🎲', '🧩', '🎯', '🎳', '🎪', '🎭', '🎨', '🎬', '🎤', '🎧',
                '🎼', '🎹', '🥁', '🎷', '🎺', '🎸', '🎻', '🎮', '🎲', '🧩', '🎯', '🎳', '🎪', '🎭', '🎨', '🎬', '🎤',
                '🎧', '🎼', '🎹', '🥁', '🎷', '🎺', '🎸', '🎻', '🎮', '🎲', '🧩', '🎯', '🎳', '🎪', '🎭', '🎨', '🎬'
            ];
            
            symbolsToRemove.forEach(symbol => {
                cleanedText = cleanedText.replace(new RegExp(symbol, 'g'), '');
            });
            
            console.log('cleanEmojis 输出:', cleanedText);
            return cleanedText;
        }
    </script>
</body>
</html>
